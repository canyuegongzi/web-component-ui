(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{439:function(t,s,a){t.exports=a.p+"assets/img/diff1.56384387.jpg"},440:function(t,s){t.exports="data:image/png;base64,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"},441:function(t,s,a){t.exports=a.p+"assets/img/diff2.83df1f93.png"},442:function(t,s,a){t.exports=a.p+"assets/img/diff3.d8513fbd.png"},443:function(t,s,a){t.exports=a.p+"assets/img/diff4.ea66312b.png"},444:function(t,s,a){t.exports=a.p+"assets/img/diff5.4efe3280.png"},445:function(t,s,a){t.exports=a.p+"assets/img/diff6.c414335e.png"},446:function(t,s,a){t.exports=a.p+"assets/img/diff7.db90a1b6.png"},613:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"diff算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diff算法"}},[t._v("#")]),t._v(" Diff算法")]),t._v(" "),n("p",[n("code",[t._v("Diff")]),t._v("算法的核心就是"),n("strong",[t._v("针对具有相同父节点的同层新旧子节点进行比较，而不是使用逐层搜索递归遍历的方式。时间复杂度为"),n("code",[t._v("O(n)")])]),t._v("。")]),t._v(" "),n("p",[t._v("如何理解？")]),t._v(" "),n("p",[t._v("说白点，就是"),n("strong",[t._v("当新旧"),n("code",[t._v("VNode")]),t._v("树在同一层具有相同的"),n("code",[t._v("VNode")]),t._v("节点时，才会继续对其子节点进行比较")]),t._v("。一旦旧"),n("code",[t._v("VNode")]),t._v("树同层中的节点在新"),n("code",[t._v("VNode")]),t._v("树中不存在或者是多余的，都会在新的真实"),n("code",[t._v("DOM")]),t._v("中进行添加或者删除。")]),t._v(" "),n("p",[t._v("下面就拿一副图进行解释。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(439),alt:""}})]),t._v(" "),n("p",[t._v("从上面的示例图可以看到，"),n("code",[t._v("Diff")]),t._v("算法中只会对同一层的元素进行比较，并且必须拥有相同节点元素，才会对其子节点进行比较，其他多余的同层节点都会一律做删除或添加操作。")]),t._v(" "),n("p",[t._v("接下来，我们就从源码角度来看看这过程到底是如何发生的。🤔")]),t._v(" "),n("h2",{attrs:{id:"diff流程图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diff流程图"}},[t._v("#")]),t._v(" diff流程图")]),t._v(" "),n("p",[t._v("当数据发生改变时，set方法会让调用"),n("code",[t._v("Dep.notify")]),t._v("通知所有订阅者"),n("code",[t._v("Watcher")]),t._v("，订阅者就会调用"),n("code",[t._v("patch")]),t._v("给真实的DOM打补丁，更新相应的视图。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(440),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"从源码角度进行探究"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#从源码角度进行探究"}},[t._v("#")]),t._v(" 从源码角度进行探究")]),t._v(" "),n("p",[t._v("我们依然是从"),n("code",[t._v("_update")]),t._v("方法入手，看看到底是如何操作的。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("_update")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓存vue实例")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" prevEl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取实例中真实DOM元素")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" prevVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取旧VNode树")]),t._v("\n  vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_vnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将新VNode树保存到实例的_vnode上，便于下次更新获取旧VNode树")]),t._v("\n  \n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("prevVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断是否有旧VNode树，并进行相应的处理")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// initial render")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最开始的一次，即第一次渲染时是没有旧VNode树，直接执行__patch__")]),t._v("\n    vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__patch__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* removeOnly */")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// updates")]),t._v("\n    vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__patch__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prevVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新VNode树与旧VNode树进行__patch__")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("每一次更新模板时，都会先将渲染好的新"),n("code",[t._v("VNode")]),t._v("树保存到实例的"),n("code",[t._v("_vnode")]),t._v("属性上，这样做的目的是为了下一次更新时，能获取到旧"),n("code",[t._v("VNode")]),t._v("树进行比较。")]),t._v(" "),n("p",[t._v("针对是否拥有旧的"),n("code",[t._v("VNode")]),t._v("树，使用"),n("code",[t._v("__patch__")]),t._v("方法执行相应逻辑，也即执行了"),n("code",[t._v("patch")]),t._v("过程。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" inBrowser "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" window "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 浏览器环境")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__patch__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" inBrowser "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" patch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" noop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只有在浏览器环境才能进行patch")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" patch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createPatchFunction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" modules"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" modules "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("可以看到，"),n("strong",[t._v("只有在浏览器的环境下才能进行"),n("code",[t._v("patch")]),t._v("过程")]),t._v("，而实现"),n("code",[t._v("patch")]),t._v("的，就是"),n("code",[t._v("createPatchFunction")]),t._v("方法，我们接着看下去。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createPatchFunction")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 省略了很多私有工具方法，下面会拿出一些进行说明")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" removeOnly")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当旧VNode树不存在时，则直接创建一个根元素")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// empty mount (likely as component), create new root element")]),t._v("\n      isInitialPatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 直接根据新VNode树并生成真实DOM")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当存在旧VNode树时，则进行相应的比较")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新旧节点是相同时")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// patch existing root node")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当新旧节点相同时则进行patch比较")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" removeOnly"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新旧节点不相同时")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oldElm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取旧节点元素")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" parentElm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parentNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取旧节点的父节点")]),t._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create new node")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 由于新旧节点是不同的，因此会根据新节点创建一个新的节点")]),t._v("\n          vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_leaveCb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// destroy old node")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建好新节点后，删除旧节点")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除响应节点后，也会调用相应的回调")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeDestroyHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("好啦，对于"),n("code",[t._v("patch")]),t._v("比较过程，你也应该有了一个大概了解。现在就来简单总结一下上述代码。")]),t._v(" "),n("ul",[n("li",[t._v("当旧"),n("code",[t._v("VNode")]),t._v("树不存在时，直接根据新"),n("code",[t._v("VNode")]),t._v("树创建相应的真实"),n("code",[t._v("DOM")]),t._v("。")]),t._v(" "),n("li",[t._v("当旧"),n("code",[t._v("VNode")]),t._v("树存在时，则会调用"),n("code",[t._v("sameVnode")]),t._v("方法比较当前新旧节点是否相同。\n"),n("ul",[n("li",[t._v("当新旧节点是相同时，会调用"),n("code",[t._v("patchVnode")]),t._v("方法比较新旧节点（过程就是继续比较其子节点，递归下去～）。")]),t._v(" "),n("li",[t._v("当新旧节点是不同时，则会先按照新"),n("code",[t._v("VNode")]),t._v("节点创建新的真实"),n("code",[t._v("DOM")]),t._v("节点，再根据旧"),n("code",[t._v("VNode")]),t._v("节点将相应的真实"),n("code",[t._v("DOM")]),t._v("节点进行删除。")])])])]),t._v(" "),n("p",[t._v("是不是很简单 🤔...那么问题来了，不是说"),n("code",[t._v("patch过")]),t._v("程是使用"),n("code",[t._v("Diff")]),t._v("算法进行比较的吗？怎么还看不到，甭急，下面我会讲到哈。")]),t._v(" "),n("p",[t._v("在上面的总结中，我们是可以看到两个方法，分别是"),n("code",[t._v("sameVnode")]),t._v("方法和"),n("code",[t._v("patchVnode")]),t._v("方法。接下来我们就来探讨一下这两个方法。")]),t._v(" "),n("h2",{attrs:{id:"samevnode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#samevnode"}},[t._v("#")]),t._v(" sameVnode")]),t._v(" "),n("p",[t._v("判断两个节点间是否相同")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断两个节点间是否相同")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 两个节点间相同，首先是唯一标识key必须相同")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isComment "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isComment "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameInputType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接着就是节点标签名、是否为注释、数据是否为空、input类型都必须相同")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isAsyncPlaceholder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asyncFactory "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asyncFactory "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asyncFactory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameInputType")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 比较两个节点的input类型是否相同")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'input'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" typeA "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" typeB "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" typeA "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" typeB "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTextInputType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("typeA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTextInputType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("typeB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("比较两个新旧节点间是很简单的，主要是按照下面几个属性进行判断。")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("VNode")]),t._v("节点唯一标识"),n("code",[t._v("key")]),t._v("。")]),t._v(" "),n("li",[t._v("是否同为注释"),n("code",[t._v("isComment")]),t._v("。")]),t._v(" "),n("li",[t._v("数据属性是否为空"),n("code",[t._v("isDef")]),t._v("。")]),t._v(" "),n("li",[t._v("是否为相同的"),n("code",[t._v("input")]),t._v("类型"),n("code",[t._v("sameInputType")]),t._v("。")])]),t._v(" "),n("h2",{attrs:{id:"patchvnode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#patchvnode"}},[t._v("#")]),t._v(" patchVnode")]),t._v(" "),n("p",[t._v("好啦，接着就到我们的主角"),n("code",[t._v("patchVnode")]),t._v("方法了，这个才是"),n("code",[t._v("Diff")]),t._v("相关方法，我们先来看看源码是如何实现的。🤔")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   ownerArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   removeOnly")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当发现两个节点是完全一模一样时，则直接返回")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" elm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prepatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据新VNode更新旧VNode的选项配置、数据属性、propsData等")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   \n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oldCh "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取oldVNode的子节点集合")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取VNode的子节点集合")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当VNode不为文本节点时")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当oldVNode的子节点和VNode的子节点都不为空时")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当oldVNode的子节点和VNode的子节点不等时，再递归执行updateChildren比较子节点")]),t._v("\n           "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChildren")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" removeOnly"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当只有VNode的子节点存在而oldVNode的子节点不存在时")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当oldVNode为文本节点时，先置空文本")]),t._v("\n           nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTextContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addVnodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据位置对真实DOM添加新的节点")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当oldVNode的子节点存在, 而VNode的子节点不存在时")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 直接移除所有多余节点")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当只有oldVNode的子节点存在,并且是文本节点时")]),t._v("\n       nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTextContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 直接置空文本处理")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当oldVNode文本节点不等于VNode文本节点时")]),t._v("\n     nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTextContent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 直接将oldVNode节点设置为VNode节点文本内容")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("patchVnode")]),t._v("方法做的事情不多，最主要就是按照一下场景做了处理;")]),t._v(" "),n("p",[n("code",[t._v("diff")]),t._v("过程中又分了好几种情况，"),n("code",[t._v("oldCh")]),t._v(" 为 "),n("code",[t._v("oldVnode")]),t._v("的子节点，"),n("code",[t._v("ch")]),t._v(" 为 "),n("code",[t._v("Vnode")]),t._v("的子节点：")]),t._v(" "),n("ul",[n("li",[t._v("首先进行文本节点的判断，若 "),n("code",[t._v("oldVnode.text !== vnode.text")]),t._v("，那么就会直接进行文本节点的替换；")]),t._v(" "),n("li",[n("code",[t._v("在vnode")]),t._v("没有文本节点的情况下，进入子节点的 "),n("code",[t._v("diff")]),t._v("；")]),t._v(" "),n("li",[t._v("当 "),n("code",[t._v("oldCh")]),t._v(" 和 "),n("code",[t._v("ch")]),t._v(" 都存在且不相同的情况下，调用 "),n("code",[t._v("updateChildren")]),t._v(" 对子节点进行 "),n("code",[t._v("diff")]),t._v("；")]),t._v(" "),n("li",[t._v("若 "),n("code",[t._v("oldCh")]),t._v("不存在，"),n("code",[t._v("ch")]),t._v(" 存在，首先清空 "),n("code",[t._v("oldVnode")]),t._v(" 的文本节点，同时调用 "),n("code",[t._v("addVnodes")]),t._v(" 方法将 "),n("code",[t._v("ch")]),t._v(" 添加到"),n("code",[t._v("elm")]),t._v("真实 dom 节点当中；")]),t._v(" "),n("li",[t._v("若 "),n("code",[t._v("oldCh")]),t._v("存在，"),n("code",[t._v("ch")]),t._v("不存在，则删除 "),n("code",[t._v("elm")]),t._v(" 真实节点下的 "),n("code",[t._v("oldCh")]),t._v(" 子节点；")]),t._v(" "),n("li",[t._v("若 "),n("code",[t._v("oldVnode")]),t._v(" 有文本节点，而 "),n("code",[t._v("vnode")]),t._v(" 没有，那么就清空这个文本节点。")])]),t._v(" "),n("p",[t._v("接下来才是最重点呀。。😅 在上面中留下了"),n("code",[t._v("updateChildren")]),t._v("方法，那么这个方法又是干啥？")]),t._v(" "),n("p",[t._v("不瞒你说，"),n("code",[t._v("updateChildren")]),t._v("方法在根据场景"),n("code",[t._v("Diff")]),t._v("后，将"),n("code",[t._v("oldVNode")]),t._v("树作出相应的改动。在没有看源码之前，我会先阐述一下。")]),t._v(" "),n("p",[n("code",[t._v("Diff算法")]),t._v("过程中，在将"),n("code",[t._v("oldVNode")]),t._v("树改动时，优先考虑相同位置的相同节点，再考虑需要移动的相同节点，最后才考虑创建或删除节点。")]),t._v(" "),n("h2",{attrs:{id:"updatechildren"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#updatechildren"}},[t._v("#")]),t._v(" updateChildren")]),t._v(" "),n("p",[t._v("有了上面的简单理解，我们就来继续探究啦 😄。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChildren")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" removeOnly")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oldStartIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 旧节点开始位置")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" newStartIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新节点开始位置")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oldEndIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 旧节点结束位置")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oldStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 旧节点第一个元素")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oldEndVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 旧节点最后一个元素")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" newEndIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新节点结束位置")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" newStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新节点第一个元素")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" newEndVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新节点最后一个元素")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" oldKeyToIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" idxInOld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnodeToMove"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" oldEndIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" newStartIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同时从新旧子节点集合开始遍历")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从第一项开始，一直遍历旧节点初始元素直到不为空为止")]),t._v("\n      oldStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Vnode has been moved left")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从最后一项开始，一直遍历旧节点直到不为空为止")]),t._v("\n      oldEndVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// （相同位置场景）当第一项旧节点和第一项新节点相同时，则继续执行patchVnode递归执行下去")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      oldStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      newStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// （相同位置场景）当最后一项旧节点和最后一项新节点相同时，则继续执行patchVnode递归执行下去")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      oldEndVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      newEndVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// （需要移动场景）当第一项旧节点和最后一项新节点相同时，先执行patchVnode递归执行下去，再执行insertBefore将真实DOM节点插入到相应位置")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      canMove "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      oldStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      newEndVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// （需要移动场景）当最后一项旧节点和第一项新节点相同时，先执行patchVnode递归执行下去，再执行insertBefore将真实DOM节点插入到相应位置")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      canMove "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      oldEndVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      newStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 比较头尾都无相同元素时，直接判断新节点是否在旧节点结合中，若有则直接移动相应的位置，若无则直接新建一个节点")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldKeyToIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" oldKeyToIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createKeyToOldIdx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将旧节点结合创建一个哈希表")]),t._v("\n      idxInOld "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" oldKeyToIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findIdxInOld")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据哈希表，判断新节点是否在哈希表中，并获得对应旧节点的索引位置")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("idxInOld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当新节点不在旧节点集合中时，新建一个真实DOM节点")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当新节点在旧节点集合中时，则会先判断两个节点是否相同")]),t._v("\n        vnodeToMove "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据索引位置获得旧节点")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnodeToMove"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当两个节点是相同时，继续执行patchVnode递归执行下去，再执行insertBefore将真实DOM节点插入到相应位置")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnodeToMove"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          canMove "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnodeToMove"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当两个节点不同时，直接新建一个新的DOM节点")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// same key but different element. treat as new element")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      newStartVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 跳出循环后，若新节点依旧存在，那么就要遍历剩余的新节点并逐个新增到真实DOM中")]),t._v("\n    refElm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addVnodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" newEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 跳出循环后，若旧节点依旧存在，那么就要将真实DOM中对应旧VNode节点进行删除操作")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"具体的diff分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#具体的diff分析"}},[t._v("#")]),t._v(" 具体的diff分析")]),t._v(" "),n("p",[t._v("我们可以假设有旧的Vnode数组和新的Vnode数组这两个数组,而且有四个变量充当指针分别指到两个数组的头尾.")]),t._v(" "),n("p",[t._v("重复下面的对比过程，直到两个数组中任一数组的头指针超过尾指针，循环结束 :")]),t._v(" "),n("ul",[n("li",[t._v("头头对比: 对比两个数组的头部，如果找到，把新节点patch到旧节点，头指针后移")]),t._v(" "),n("li",[t._v("尾尾对比: 对比两个数组的尾部，如果找到，把新节点patch到旧节点，尾指针前移")]),t._v(" "),n("li",[t._v("旧尾新头对比: 交叉对比，旧尾新头，如果找到，把新节点patch到旧节点，旧尾指针前移，新头指针后移")]),t._v(" "),n("li",[t._v("旧头新尾对比: 交叉对比，旧头新尾，如果找到，把新节点patch到旧节点，新尾指针前移，旧头指针后移")]),t._v(" "),n("li",[t._v("利用key对比: 用新指针对应节点的key去旧数组寻找对应的节点,这里分三种情况,当没有对应的key，那么创建新的节点,如果有key并且是相同的节点，把新节点patch到旧节点,如果有key但是不是相同的节点，则创建新节点")])]),t._v(" "),n("p",[t._v("我们假设有新旧两个数组:")]),t._v(" "),n("ul",[n("li",[t._v("旧数组: "),n("code",[t._v("[1, 2, 3, 4, 5]")])]),t._v(" "),n("li",[t._v("新数组: "),n("code",[t._v("[1, 4, 6, 1000, 100, 5]")])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(441),alt:""}})]),t._v(" "),n("p",[t._v("首先我们进行头头对比,新旧数组的头部都是"),n("code",[t._v("1")]),t._v(",因此将双方的头部指针后移.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(442),alt:""}})]),t._v(" "),n("p",[t._v("我们继续头头对比,但是"),n("code",[t._v("2 !== 4")]),t._v("导致对比失败,我进入尾尾对比,"),n("code",[t._v("5 === 5")]),t._v(",那么尾部指针则可前移.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(443),alt:""}})]),t._v(" "),n("p",[t._v("现在进入新的循环,头头对比"),n("code",[t._v("2 !== 4")]),t._v(",尾尾对比"),n("code",[t._v("4 !== 100")]),t._v(",此时进入交叉对比,先进行旧尾新头对比,即"),n("code",[t._v("4 === 4")]),t._v(",旧尾前移且新头后移.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(444),alt:""}})]),t._v(" "),n("p",[t._v("接着再进入一个轮新的循环,头头对比"),n("code",[t._v("2 !== 6")]),t._v(",尾尾对比"),n("code",[t._v("3 !== 100")]),t._v(",交叉对比"),n("code",[t._v("2 != 100 3 != 6")]),t._v(",四种对比方式全部不符合,如果这个时候需要通过"),n("code",[t._v("key")]),t._v("去对比,然后将新头指针后移")]),t._v(" "),n("p",[n("img",{attrs:{src:a(445),alt:""}})]),t._v(" "),n("p",[t._v("继续重复上述对比的循环方式直至任一数组的头指针超过尾指针，循环结束.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(446),alt:""}})]),t._v(" "),n("p",[t._v("在上述循环结束后,两个数组中可能存在未遍历完的情况: 循环结束后，")]),t._v(" "),n("ul",[n("li",[t._v("先对比旧数组的头尾指针，如果旧数组遍历完了（可能新数组没遍历完，有漏添加的问题），添加新数组中漏掉的节点")]),t._v(" "),n("li",[t._v("再对比新数组的头尾指针，如果新数组遍历完了（可能旧数组没遍历完，有漏删除的问题），删除旧数组中漏掉的节点")])]),t._v(" "),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://juejin.im/post/5d36cc575188257aea108a74",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue核心之虚拟DOM"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/aooy/blog/issues/2",target:"_blank",rel:"noopener noreferrer"}},[t._v("解析vue2.0的diff算法"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5affd01551882542c83301da",target:"_blank",rel:"noopener noreferrer"}},[t._v("详解vue的diff算法"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5d3f3bf36fb9a06af824b3e2#heading-5",target:"_blank",rel:"noopener noreferrer"}},[t._v("面试官: 你对虚拟DOM原理的理解?"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/Andraw-lin/about-Vue/blob/master/docs/%E3%80%90%20Vue%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E3%80%91%E5%A6%82%E4%BD%95%E5%9C%A8%E6%9B%B4%E6%96%B0%20Patch%20%E4%B8%AD%E8%BF%9B%E8%A1%8C%20Diff.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("【 Vue 源码分析 】如何在更新 Patch 中进行 Diff.md"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);