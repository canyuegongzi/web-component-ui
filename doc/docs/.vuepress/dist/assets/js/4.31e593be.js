(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{306:function(t,a,s){t.exports=s.p+"assets/img/angular-split-code-compare.92481961.jpg"},307:function(t,a,s){t.exports=s.p+"assets/img/choice-your-microservices.8a002c9b.png"},308:function(t,a,s){t.exports=s.p+"assets/img/mooa-graph.7272c84d.jpg"},309:function(t,a,s){t.exports=s.p+"assets/img/mooa-app.5053c432.jpg"},331:function(t,a,s){t.exports=s.p+"assets/img/angular-tabs-example.65ab370b.png"},332:function(t,a,s){t.exports=s.p+"assets/img/web-components-architecture.a9eeefba.png"},333:function(t,a,s){t.exports=s.p+"assets/img/workflow.83c7eccf.png"},362:function(t,a,s){t.exports=s.p+"assets/img/9787121365348.21476dce.jpg"},487:function(t,a,s){"use strict";s.r(a);var n=s(45),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"微前端综述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端综述"}},[t._v("#")]),t._v(" 微前端综述")]),t._v(" "),n("p",[t._v("该文转载自网络，在此仅作为留存记录。")]),t._v(" "),n("blockquote",[n("p",[t._v("微前端是一种类似于微服务的架构，它将微服务的理念应用于浏览器端，即将 Web 应用由单一的单体应用转变为"),n("strong",[t._v("多个小型前端应用聚合为一的应用")]),t._v("。各个前端应用还可以"),n("strong",[t._v("独立运行")]),t._v("、"),n("strong",[t._v("独立开发")]),t._v("、"),n("strong",[t._v("独立部署")]),t._v("。")])]),t._v(" "),n("p",[t._v("同时，它们也可以在"),n("strong",[t._v("共享组件")]),t._v("的同时进行并行开发——这些组件可以通过 NPM 或者 Git Tag、Git Submodule 来管理。")]),t._v(" "),n("p",[n("strong",[t._v("注意")]),t._v("：这里的前端应用指的是前后端分离的单页面应用，在这基础才谈论微前端才有意义。")]),t._v(" "),n("p",[n("strong",[t._v("目录")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF"}},[t._v("微前端的那些事儿")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%AE%9E%E6%96%BD%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E5%BC%8F"}},[t._v("实施微前端的六种方式")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%9F%BA%E7%A1%80%E9%93%BA%E5%9E%AB%E5%BA%94%E7%94%A8%E5%88%86%E5%8F%91%E8%B7%AF%E7%94%B1---%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E5%BA%94%E7%94%A8"}},[t._v("基础铺垫：应用分发路由 ->\n路由分发应用")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%90%8E%E7%AB%AF%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8---%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"}},[t._v("后端：函数调用 -> 远程调用")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E8%B0%83%E7%94%A8---%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8"}},[t._v("前端：组件调用 -> 应用调用")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E5%BC%8F%E5%BE%AE%E5%89%8D%E7%AB%AF"}},[t._v("路由分发式微前端")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8-iframe-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"}},[t._v("使用 iFrame 创建容器")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%87%AA%E5%88%B6%E6%A1%86%E6%9E%B6%E5%85%BC%E5%AE%B9%E5%BA%94%E7%94%A8"}},[t._v("自制框架兼容应用")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%BB%84%E5%90%88%E5%BC%8F%E9%9B%86%E6%88%90%E5%B0%86%E5%BA%94%E7%94%A8%E5%BE%AE%E4%BB%B6%E5%8C%96"}},[t._v("组合式集成：将应用微件化")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%BA%AF-web-components-%E6%8A%80%E6%9C%AF%E6%9E%84%E5%BB%BA"}},[t._v("纯 Web Components 技术构建")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%BB%93%E5%90%88-web-components-%E6%9E%84%E5%BB%BA"}},[t._v("结合 Web Components 构建")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%9C%A8-web-components-%E4%B8%AD%E9%9B%86%E6%88%90%E7%8E%B0%E6%9C%89%E6%A1%86%E6%9E%B6"}},[t._v("在 Web Components 中集成现有框架")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E9%9B%86%E6%88%90%E5%9C%A8%E7%8E%B0%E6%9C%89%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84-web-components"}},[t._v("集成在现有框架中的 Web Components")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%A4%8D%E5%90%88%E5%9E%8B"}},[t._v("复合型")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%BC%80%E5%A7%8B%E5%9C%A8%E6%B5%81%E8%A1%8Cweb-%E5%BA%94%E7%94%A8%E7%9A%84%E8%81%9A%E5%90%88"}},[t._v("为什么微前端开始在流行------Web 应用的聚合")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E9%81%97%E7%95%99%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB"}},[t._v("前端遗留系统迁移")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%90%8E%E7%AB%AF%E8%A7%A3%E8%80%A6%E5%89%8D%E7%AB%AF%E8%81%9A%E5%90%88"}},[t._v("后端解耦，前端聚合")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%85%BC%E5%AE%B9%E9%81%97%E7%95%99%E7%B3%BB%E7%BB%9F"}},[t._v("兼容遗留系统")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%A6%82%E4%BD%95%E8%A7%A3%E6%9E%84%E5%8D%95%E4%BD%93%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%8F%E6%8B%86%E5%88%86"}},[t._v("如何解构单体前端应用------前端应用的微服务式拆分")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8C%96"}},[t._v("前端微服化")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91"}},[t._v("独立开发")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%8B%AC%E7%AB%8B%E9%83%A8%E7%BD%B2"}},[t._v("独立部署")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E6%88%91%E4%BB%AC%E7%9C%9F%E7%9A%84%E9%9C%80%E8%A6%81%E6%8A%80%E6%9C%AF%E6%97%A0%E5%85%B3%E5%90%97"}},[t._v("我们真的需要技术无关吗？")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%8D%E5%BD%B1%E5%93%8D%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C"}},[t._v("不影响用户体验")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5"}},[t._v("微前端的设计理念")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E4%B8%80%E4%B8%AD%E5%BF%83%E5%8C%96%E8%B7%AF%E7%94%B1"}},[t._v("设计理念一：中心化路由")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E4%BA%8C%E6%A0%87%E8%AF%86%E5%8C%96%E5%BA%94%E7%94%A8"}},[t._v("设计理念二：标识化应用")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E4%B8%89%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[t._v("设计理念三：生命周期")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E5%9B%9B%E7%8B%AC%E7%AB%8B%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8C%96"}},[t._v("设计理念四：独立部署与配置自动化")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%AE%9E%E6%88%98%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"}},[t._v("实战微前端架构设计")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E7%8B%AC%E7%AB%8B%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8C%96"}},[t._v("独立部署与配置自动化")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BA%94%E7%94%A8%E9%97%B4%E8%B7%AF%E7%94%B1%E4%BA%8B%E4%BB%B6"}},[t._v("应用间路由------事件")])])])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%A4%A7%E5%9E%8B-angular-%E5%BA%94%E7%94%A8%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%8B%86%E5%88%86%E7%AD%96%E7%95%A5"}},[t._v("大型 Angular 应用微前端的四种拆分策略")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD%E5%8F%8A%E5%85%B6%E5%8F%98%E4%BD%93"}},[t._v("前端微服务化：路由懒加载及其变体")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%96%B9%E6%A1%88%E5%AD%90%E5%BA%94%E7%94%A8%E6%A8%A1%E5%BC%8F"}},[t._v("微服务化方案：子应用模式")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"}},[t._v("方案对比")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E6%A0%87%E5%87%86-lazyload"}},[t._v("标准 LazyLoad")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#lazyload-%E5%8F%98%E4%BD%93-1%E6%9E%84%E5%BB%BA%E6%97%B6%E9%9B%86%E6%88%90"}},[t._v("LazyLoad 变体 1：构建时集成")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#lazyload-%E5%8F%98%E4%BD%93-2%E6%9E%84%E5%BB%BA%E5%90%8E%E9%9B%86%E6%88%90"}},[t._v("LazyLoad 变体 2：构建后集成")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96"}},[t._v("前端微服务化")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E6%80%BB%E5%AF%B9%E6%AF%94"}},[t._v("总对比")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E4%BD%BF%E7%94%A8%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6-mooa-%E5%BC%80%E5%8F%91%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8"}},[t._v("前端微服务化：使用微前端框架 Mooa 开发微前端应用")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#mooa-%E6%A6%82%E5%BF%B5"}},[t._v("Mooa 概念")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E4%B8%BB%E5%B7%A5%E7%A8%8B%E5%88%9B%E5%BB%BA"}},[t._v("微前端主工程创建")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#mooa-%E5%AD%90%E5%BA%94%E7%94%A8%E5%88%9B%E5%BB%BA"}},[t._v("Mooa 子应用创建")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%AF%BC%E8%88%AA%E5%88%B0%E7%89%B9%E5%AE%9A%E7%9A%84%E5%AD%90%E5%BA%94%E7%94%A8"}},[t._v("导航到特定的子应用")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E4%BD%BF%E7%94%A8%E7%89%B9%E5%88%B6%E7%9A%84-iframe-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96-angular-%E5%BA%94%E7%94%A8"}},[t._v("前端微服务化：使用特制的 iframe 微服务化 Angular 应用")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#iframe-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"}},[t._v("iframe 微服务架构设计")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6-mooa-%E7%9A%84%E7%89%B9%E5%88%B6-iframe-%E6%A8%A1%E5%BC%8F"}},[t._v("微前端框架 Mooa 的特制 iframe 模式")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6-mooa-iframe-%E9%80%9A%E8%AE%AF%E6%9C%BA%E5%88%B6"}},[t._v("微前端框架 Mooa iframe 通讯机制")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%8F%91%E5%B8%83%E4%B8%BB%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6"}},[t._v("发布主应用事件")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%9B%91%E5%90%AC%E5%AD%90%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6"}},[t._v("监听子应用事件")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B"}},[t._v("示例")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%B5%84%E6%BA%90"}},[t._v("资源")])])]),t._v(" "),n("h1",{attrs:{id:"为什么微前端开始在流行-web-应用的聚合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么微前端开始在流行-web-应用的聚合"}},[t._v("#")]),t._v(" 为什么微前端开始在流行——Web 应用的聚合")]),t._v(" "),n("blockquote",[n("p",[t._v("采用新技术，更多不是因为先进，而是因为它能解决痛点。")])]),t._v(" "),n("p",[t._v("过去，我一直有一个疑惑，人们是否真的需要微服务，是否真的需要微前端。毕竟，没有银弹。当人们考虑是否采用一种新的架构，除了考虑它带来好处之外，仍然也考量着存在的大量的风险和技术挑战。")]),t._v(" "),n("h2",{attrs:{id:"前端遗留系统迁移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端遗留系统迁移"}},[t._v("#")]),t._v(" 前端遗留系统迁移")]),t._v(" "),n("p",[t._v("自微前端框架 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v(" 及对应的《"),n("a",{attrs:{href:"https://github.com/phodal/microfrontend",target:"_blank",rel:"noopener noreferrer"}},[t._v("微前端的那些事儿"),n("OutboundLink")],1),t._v("》发布的两个多月以来，我陆陆续续地接收到一些微前端架构的一些咨询。过程中，我发现了一件很有趣的事："),n("strong",[t._v("解决遗留系统，才是人们采用微前端方案最重要的原因")]),t._v("。")]),t._v(" "),n("p",[t._v("这些咨询里，开发人员所遇到的情况，与我之前遇到的情形并相似，我的场景是：设计一个新的前端架构。他们开始考虑前端微服务化，是因为遗留系统的存在。")]),t._v(" "),n("p",[t._v("过去那些使用 Backbone.js、Angular.js、Vue.js 1 等等框架所编写的单页面应用，已经在线上稳定地运行着，也没有新的功能。对于这样的应用来说，我们也没有理由浪费时间和精力重写旧的应用。这里的那些使用旧的、不再使用的技术栈编写的应用，可以称为遗留系统。而，这些应用又需要结合到新应用中使用。我遇到的较多的情况是：旧的应用使用的是 Angular.js 编写，而新的应用开始采用 Angular 2+。这对于业务稳定的团队来说，是极为常见的技术栈。")]),t._v(" "),n("p",[t._v("在即不重写原有系统的基础之下，又可以抽出人力来开发新的业务。其不仅仅对于业务人员来说， 是一个相当吸引力的特性；对于技术人员来说，不重写旧的业务，同时还能做一些技术上的挑战，也是一件相当有挑战的事情。")]),t._v(" "),n("h2",{attrs:{id:"后端解耦-前端聚合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端解耦-前端聚合"}},[t._v("#")]),t._v(" 后端解耦，前端聚合")]),t._v(" "),n("p",[t._v("而前端微服务的一个卖点也在这里，去兼容不同类型的前端框架。这让我又联想到微服务的好处，及许多项目落地微服务的原因：")]),t._v(" "),n("p",[t._v("在初期，后台微服务的一个很大的卖点在于，可以使用不同的技术栈来开发后台应用。但是，事实上，采用微服务架构的组织和机构，一般都是中大型规模的。相较于中小型，对于框架和语言的选型要求比较严格，如在内部限定了框架，限制了语言。因此，在充分使用不同的技术栈来发挥微服务的优势这一点上，几乎是很少出现的。在这些大型组织机构里，采用微服务的原因主要还是在于，"),n("strong",[t._v("使用微服务架构来解耦服务间依赖")]),t._v("。")]),t._v(" "),n("p",[t._v("而在前端微服务化上，则是恰恰与之相反的，人们更想要的结果是"),n("strong",[t._v("聚合")]),t._v("，尤其是那些 To B（to Bussiness）的应用。")]),t._v(" "),n("p",[t._v("在这两三年里，移动应用出现了一种趋势，用户不想装那么多应用了。而往往一家大的商业公司，会提供一系列的应用。这些应用也从某种程度上，反应了这家公司的组织架构。然而，在用户的眼里他们就是一家公司，他们就只应该有一个产品。相似的，这种趋势也在桌面 Web 出现。"),n("strong",[t._v("聚合")]),t._v("成为了一个技术趋势，体现在前端的聚合就是微服务化架构。")]),t._v(" "),n("h2",{attrs:{id:"兼容遗留系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#兼容遗留系统"}},[t._v("#")]),t._v(" 兼容遗留系统")]),t._v(" "),n("p",[t._v("那么，在这个时候，我们就需要使用新的技术、新的架构，来容纳、兼容这些旧的应用。而前端微服务化，正好是契合人们想要的这个卖点罢了。")]),t._v(" "),n("h1",{attrs:{id:"实施微前端的六种方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实施微前端的六种方式"}},[t._v("#")]),t._v(" 实施微前端的六种方式")]),t._v(" "),n("p",[t._v("微前端架构是一种类似于微服务的架构，它将微服务的理念应用于浏览器端，即将 Web 应用由单一的单体应用转变为"),n("strong",[t._v("多个小型前端应用聚合为一的应用")]),t._v("。")]),t._v(" "),n("p",[t._v("由此带来的变化是，这些前端应用可以"),n("strong",[t._v("独立运行")]),t._v("、"),n("strong",[t._v("独立开发")]),t._v("、"),n("strong",[t._v("独立部署")]),t._v("。以及，它们应该可以在"),n("strong",[t._v("共享组件")]),t._v("的同时进行并行开发——这些组件可以通过 NPM 或者 Git Tag、Git Submodule 来管理。")]),t._v(" "),n("p",[n("strong",[t._v("注意")]),t._v("：这里的前端应用指的是前后端分离的单应用页面，在这基础才谈论微前端才有意义。")]),t._v(" "),n("p",[t._v("结合我最近半年在"),n("a",{attrs:{href:"https://github.com/phodal/microfrontends",target:"_blank",rel:"noopener noreferrer"}},[t._v("微前端"),n("OutboundLink")],1),t._v("方面的实践和研究来看，微前端架构一般可以由以下几种方式进行：")]),t._v(" "),n("ol",[n("li",[t._v("使用 HTTP 服务器的路由来重定向多个应用")]),t._v(" "),n("li",[t._v("在不同的框架之上设计通讯、加载机制，诸如 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v(" 和 "),n("a",{attrs:{href:"https://github.com/CanopyTax/single-spa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Single-SPA"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("通过组合多个独立应用、组件来构建一个单体应用")]),t._v(" "),n("li",[t._v("iFrame。使用 iFrame 及自定义消息传递机制")]),t._v(" "),n("li",[t._v("使用纯 Web Components 构建应用")]),t._v(" "),n("li",[t._v("结合 Web Components 构建")])]),t._v(" "),n("h2",{attrs:{id:"基础铺垫-应用分发路由-路由分发应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础铺垫-应用分发路由-路由分发应用"}},[t._v("#")]),t._v(" 基础铺垫：应用分发路由 -> 路由分发应用")]),t._v(" "),n("p",[t._v("在一个单体前端、单体后端应用中，有一个典型的特征，即路由是由"),n("strong",[t._v("框架")]),t._v("来分发的，框架将路由指定到对应的组件或者内部服务中。微服务在这个过程中做的事情是，将调用由"),n("strong",[t._v("函数调用")]),t._v("变成了"),n("strong",[t._v("远程调用")]),t._v("，诸如远程 HTTP 调用。而微前端呢，也是类似的，它是将"),n("strong",[t._v("应用内的组件调用")]),t._v("变成了更细粒度的"),n("strong",[t._v("应用间组件调用")]),t._v("，即原先我们只是将路由分发到应用的组件执行，现在则需要根据路由来找到对应的应用，再由应用分发到对应的组件上。")]),t._v(" "),n("h3",{attrs:{id:"后端-函数调用-远程调用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端-函数调用-远程调用"}},[t._v("#")]),t._v(" 后端：函数调用 -> 远程调用")]),t._v(" "),n("p",[t._v("在大多数的 CRUD 类型的 Web 应用中，也都存在一些极为相似的模式，即：首页 -> 列表 -> 详情：")]),t._v(" "),n("ul",[n("li",[t._v("首页，用于面向用户展示特定的数据或页面。这些数据通常是有限个数的，并且是多种模型的。")]),t._v(" "),n("li",[t._v("列表，即数据模型的聚合，其典型特点是某一类数据的集合，可以看到尽可能多的"),n("strong",[t._v("数据概要")]),t._v("（如 Google 只返回  100 页），典型见 Google、淘宝、京东的搜索结果页。")]),t._v(" "),n("li",[t._v("详情，展示一个数据的尽可能多的内容。")])]),t._v(" "),n("p",[t._v("如下是一个 Spring 框架，用于返回首页的示例：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("homePage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/WEB-INF/jsp/index.jsp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("对于某个详情页面来说，它可能是这样的：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/detail/{detailId}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("detail")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletRequest")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelMap")]),t._v(" model"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/WEB-INF/jsp/detail.jsp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"detail"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("那么，在微服务的情况下，它则会变成这样子：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('@RequestMapping("/name")\npublic String name(){\n    String name = restTemplate.getForObject("http://account/name", String.class);\n    return Name" + name;\n}\n')])])]),n("p",[t._v("而后端在这个过程中，多了一个服务发现的服务，来管理不同微服务的关系。")]),t._v(" "),n("h3",{attrs:{id:"前端-组件调用-应用调用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端-组件调用-应用调用"}},[t._v("#")]),t._v(" 前端：组件调用 -> 应用调用")]),t._v(" "),n("p",[t._v("在形式上来说，单体前端框架的路由和单体后端应用，并没有太大的区别："),n("strong",[t._v("依据不同的路由，来返回不同页面的模板。")])]),t._v(" "),n("div",{staticClass:"language-javascritp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("const appRoutes: Routes = [\n  { path: 'index', component: IndexComponent },\n  { path: 'detail/:id', component: DetailComponent },\n];\n")])])]),n("p",[t._v("而当我们将之微服务化后，则可能变成应用 A 的路由：")]),t._v(" "),n("div",{staticClass:"language-javascritp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("const appRoutes: Routes = [\n  { path: 'index', component: IndexComponent },\n];\n")])])]),n("p",[t._v("外加之应用 B 的路由：")]),t._v(" "),n("div",{staticClass:"language-javascritp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("const appRoutes: Routes = [\n  { path: 'detail/:id', component: DetailComponent },\n];\n")])])]),n("p",[t._v("而问题的关键就在于："),n("strong",[t._v("怎么将路由分发到这些不同的应用中去")]),t._v("。与此同时，还要负责管理不同的前端应用。")]),t._v(" "),n("h2",{attrs:{id:"路由分发式微前端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由分发式微前端"}},[t._v("#")]),t._v(" 路由分发式微前端")]),t._v(" "),n("p",[n("strong",[t._v("路由分发式微前端")]),t._v("，即通过路由将不同的业务"),n("strong",[t._v("分发到不同的、独立前端应用")]),t._v("上。其通常可以通过 HTTP 服务器的反向代理来实现，又或者是应用框架自带的路由来解决。")]),t._v(" "),n("p",[t._v("就当前而言，通过路由分发式的微前端架构应该是采用最多、最易采用的 “微前端” 方案。但是这种方式看上去更像是"),n("strong",[t._v("多个前端应用的聚合")]),t._v("，即我们只是将这些不同的前端应用拼凑到一起，使他们看起来像是一个完整的整体。但是它们并不是，每次用户从 A 应用到 B 应用的时候，往往需要刷新一下页面。")]),t._v(" "),n("p",[t._v("在几年前的一个项目里，我们当时正在进行"),n("strong",[t._v("遗留系统重写")]),t._v("。我们制定了一个迁移计划：")]),t._v(" "),n("ol",[n("li",[t._v("首先，使用"),n("strong",[t._v("静态网站生成")]),t._v("动态生成首页")]),t._v(" "),n("li",[t._v("其次，使用 React 计划栈重构详情页")]),t._v(" "),n("li",[t._v("最后，替换搜索结果页")])]),t._v(" "),n("p",[t._v("整个系统并不是一次性迁移过去，而是一步步往下进行。因此在完成不同的步骤时，我们就需要上线这个功能，于是就需要使用 Nginx 来进行路由分发。")]),t._v(" "),n("p",[t._v("如下是一个基于路由分发的 Nginx 配置示例：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("http {\n  server {\n    listen       80;\n    server_name  www.phodal.com;\n    location /api/ {\n      proxy_pass http://http://172.31.25.15:8000/api;\n    }\n    location /web/admin {\n      proxy_pass http://172.31.25.29/web/admin;\n    }\n    location /web/notifications {\n      proxy_pass http://172.31.25.27/web/notifications;\n    }\n    location / {\n      proxy_pass /;\n    }\n  }\n}\n")])])]),n("p",[t._v("在这个示例里，不同的页面的请求被分发到不同的服务器上。")]),t._v(" "),n("p",[t._v("随后，我们在别的项目上也使用了类似的方式，其主要原因是："),n("strong",[t._v("跨团队的协作")]),t._v("。当团队达到一定规模的时候，我们不得不面对这个问题。除此，还有 Angluar 跳崖式升级的问题。于是，在这种情况下，用户前台使用 Angular 重写，后台继续使用 Angular.js 等保持再有的技术栈。在不同的场景下，都有一些相似的技术决策。")]),t._v(" "),n("p",[t._v("因此在这种情况下，它适用于以下场景：")]),t._v(" "),n("ul",[n("li",[t._v("不同技术栈之间差异比较大，难以兼容、迁移、改造")]),t._v(" "),n("li",[t._v("项目不想花费大量的时间在这个系统的改造上")]),t._v(" "),n("li",[t._v("现有的系统在未来将会被取代")]),t._v(" "),n("li",[t._v("系统功能已经很完善，基本不会有新需求")])]),t._v(" "),n("p",[t._v("而在满足上面场景的情况下，如果为了更好的用户体验，还可以采用 iframe 的方式来解决。")]),t._v(" "),n("h2",{attrs:{id:"使用-iframe-创建容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-iframe-创建容器"}},[t._v("#")]),t._v(" 使用 iFrame 创建容器")]),t._v(" "),n("p",[t._v("iFrame 作为一个非常古老的，人人都觉得普通的技术，却一直很管用。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("HTML 内联框架元素")]),t._v(" "),n("code",[t._v("<iframe>")]),t._v(" 表示嵌套的正在浏览的上下文，能有效地将另一个 HTML 页面嵌入到当前页面中。")])]),t._v(" "),n("p",[t._v("iframe 可以创建一个全新的独立的宿主环境，这意味着我们的前端应用之间可以相互独立运行。采用 iframe 有几个重要的前提：")]),t._v(" "),n("ul",[n("li",[t._v("网站不需要 SEO 支持")]),t._v(" "),n("li",[t._v("拥有相应的"),n("strong",[t._v("应用管理机制")]),t._v("。")])]),t._v(" "),n("p",[t._v("如果我们做的是一个应用平台，会在我们的系统中集成第三方系统，或者多个不同部门团队下的系统，显然这是一个不错的方案。一些典型的场景，如传统的 Desktop 应用迁移到 Web 应用：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(331),alt:"Angular Tabs 示例"}})]),t._v(" "),n("p",[t._v("如果这一类应用过于复杂，那么它必然是要进行微服务化的拆分。因此，在采用 iframe 的时候，我们需要做这么两件事：")]),t._v(" "),n("ul",[n("li",[t._v("设计"),n("strong",[t._v("管理应用机制")])]),t._v(" "),n("li",[t._v("设计"),n("strong",[t._v("应用通讯机制")])])]),t._v(" "),n("p",[n("strong",[t._v("加载机制")]),t._v("。在什么情况下，我们会去加载、卸载这些应用；在这个过程中，采用怎样的动画过渡，让用户看起来更加自然。")]),t._v(" "),n("p",[n("strong",[t._v("通讯机制")]),t._v("。直接在每个应用中创建 "),n("code",[t._v("postMessage")]),t._v(" 事件并监听，并不是一个友好的事情。其本身对于应用的侵入性太强，因此通过 "),n("code",[t._v("iframeEl.contentWindow")]),t._v(" 去获取 iFrame 元素的 Window 对象是一个更简化的做法。随后，就需要"),n("strong",[t._v("定义一套通讯规范")]),t._v("：事件名采用什么格式、什么时候开始监听事件等等。")]),t._v(" "),n("p",[t._v("有兴趣的读者，可以看看笔者之前写的微前端框架："),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v("不管怎样，iframe 对于我们今年的 KPI 怕是带不来一丝的好处，那么我们就去造个轮子吧。")]),t._v(" "),n("h2",{attrs:{id:"自制框架兼容应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自制框架兼容应用"}},[t._v("#")]),t._v(" 自制框架兼容应用")]),t._v(" "),n("p",[t._v("不论是基于 Web Components 的 Angular，或者是 VirtualDOM 的 React 等，现有的前端框架都离不开基本的 HTML 元素 DOM。")]),t._v(" "),n("p",[t._v("那么，我们只需要：")]),t._v(" "),n("ol",[n("li",[t._v("在页面合适的地方引入或者创建 DOM")]),t._v(" "),n("li",[t._v("用户操作时，加载对应的应用（触发应用的启动），并能卸载应用。")])]),t._v(" "),n("p",[t._v("第一个问题，创建 DOM 是一个容易解决的问题。而第二个问题，则一点儿不容易，特别是移除 DOM 和相应应用的监听。当我们拥有一个不同的技术栈时，我们就需要有针对性设计出一套这样的逻辑。")]),t._v(" "),n("p",[t._v("尽管 "),n("a",{attrs:{href:"https://github.com/CanopyTax/single-spa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Single-SPA"),n("OutboundLink")],1),t._v(" 已经拥有了大部分框架（如 React、Angular、Vue 等框架）的启动和卸载处理，但是它仍然不是适合于生产用途。当我基于 Single-SPA 为 Angular 框架设计一个微前端架构的应用时，我最后选择重写一个自己的框架，即 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v("虽然，这种方式的上手难度相对比较高，但是后期订制及可维护性比较方便。在不考虑每次加载应用带来的用户体验问题，其唯一存在的风险可能是："),n("strong",[t._v("第三方库不兼容")]),t._v("。")]),t._v(" "),n("p",[t._v("但是，不论怎样，与 iFrame 相比，其在技术上更具有"),n("strong",[t._v("可吹牛逼性")]),t._v("，更有看点。同样的，与 iframe 类似，我们仍然面对着一系列的不大不小的问题：")]),t._v(" "),n("ul",[n("li",[t._v("需要设计一套管理应用的机制。")]),t._v(" "),n("li",[t._v("对于流量大的 toC 应用来说，会在首次加载的时候，会多出大量的请求")])]),t._v(" "),n("p",[t._v("而我们即又要拆分应用，又想 blabla……，我们还能怎么做？")]),t._v(" "),n("h2",{attrs:{id:"组合式集成-将应用微件化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#组合式集成-将应用微件化"}},[t._v("#")]),t._v(" 组合式集成：将应用微件化")]),t._v(" "),n("p",[n("strong",[t._v("组合式集成")]),t._v("，即通过"),n("strong",[t._v("软件工程")]),t._v("的方式在构建前、构建时、构建后等步骤中，对应用进行一步的拆分，并重新组合。")]),t._v(" "),n("p",[t._v("从这种定义上来看，它可能算不上并不是一种微前端——它可以满足了微前端的三个要素，即："),n("strong",[t._v("独立运行")]),t._v("、"),n("strong",[t._v("独立开发")]),t._v("、"),n("strong",[t._v("独立部署")]),t._v("。但是，配合上前端框架的组件 Lazyload 功能——即在需要的时候，才加载对应的业务组件或应用，它看上去就是一个微前端应用。")]),t._v(" "),n("p",[t._v("与此同时，由于所有的依赖、Pollyfill 已经尽可能地在首次加载了，CSS 样式也不需要重复加载。")]),t._v(" "),n("p",[t._v("常见的方式有：")]),t._v(" "),n("ul",[n("li",[t._v("独立构建组件和应用，生成 chunk 文件，构建后再"),n("strong",[t._v("归类")]),t._v("生成的 chunk 文件。（这种方式更类似于微服务，但是成本更高）")]),t._v(" "),n("li",[t._v("开发时独立开发组件或应用，集成时合并组件和应用，最后生成单体的应用。")]),t._v(" "),n("li",[t._v("在运行时，加载应用的 Runtime，随后加载对应的应用代码和模板。")])]),t._v(" "),n("p",[t._v("应用间的关系如下图所示（其忽略图中的 “前端微服务化”）：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(306),alt:"组合式集成对比"}})]),t._v(" "),n("p",[t._v("这种方式看上去相当的理想，即能满足多个团队并行开发，又能构建出适合的交付物。")]),t._v(" "),n("p",[t._v("但是，首先它有一个严重的限制："),n("strong",[t._v("必须使用同一个框架")]),t._v("。对于多数团队来说，这并不是问题。采用微服务的团队里，也不会因为微服务这一个前端，来使用不同的语言和技术来开发。当然了，如果要使用别的框架，也不是问题，我们只需要结合上一步中的"),n("strong",[t._v("自制框架兼容应用")]),t._v("就可以满足我们的需求。")]),t._v(" "),n("p",[t._v("其次，采用这种方式还有一个限制，那就是："),n("strong",[t._v("规范！****规范！****规范！")]),t._v("。在采用这种方案时，我们需要：")]),t._v(" "),n("ul",[n("li",[t._v("统一依赖。统一这些依赖的版本，引入新的依赖时都需要一一加入。")]),t._v(" "),n("li",[t._v("规范应用的组件及路由。避免不同的应用之间，因为这些组件名称发生冲突。")]),t._v(" "),n("li",[t._v("构建复杂。在有些方案里，我们需要修改构建系统，有些方案里则需要复杂的架构脚本。")]),t._v(" "),n("li",[t._v("共享通用代码。这显然是一个要经常面对的问题。")]),t._v(" "),n("li",[t._v("制定代码规范。")])]),t._v(" "),n("p",[t._v("因此，这种方式看起来更像是一个软件工程问题。")]),t._v(" "),n("p",[t._v("现在，我们已经有了四种方案，每个方案都有自己的利弊。显然，结合起来会是一种更理想的做法。")]),t._v(" "),n("p",[t._v("考虑到现有及常用的技术的局限性问题，让我们再次将目光放得长远一些。")]),t._v(" "),n("h2",{attrs:{id:"纯-web-components-技术构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#纯-web-components-技术构建"}},[t._v("#")]),t._v(" 纯 Web Components 技术构建")]),t._v(" "),n("p",[t._v("在学习 Web Components 开发微前端架构的过程中，我尝试去写了我自己的 Web Components 框架："),n("a",{attrs:{href:"https://github.com/phodal/oan",target:"_blank",rel:"noopener noreferrer"}},[t._v("oan"),n("OutboundLink")],1),t._v("。在添加了一些基本的 Web 前端框架的功能之后，我发现这项技术特别适合于"),n("strong",[t._v("作为微前端的基石")]),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("Web Components 是一套不同的技术，允许您创建可重用的定制元素（它们的功能封装在您的代码之外）并且在您的 Web 应用中使用它们。")])]),t._v(" "),n("p",[t._v("它主要由四项技术组件：")]),t._v(" "),n("ul",[n("li",[t._v("Custom elements，允许开发者创建自定义的元素，诸如 "),n("today-news"),t._v("。")],1),t._v(" "),n("li",[t._v("Shadow DOM，即影子 DOM，通常是将 Shadow DOM 附加到主文档 DOM 中，并可以控制其关联的功能。而这个 Shadow DOM 则是不能直接用其它主文档 DOM 来控制的。")]),t._v(" "),n("li",[t._v("HTML templates，即 "),n("code",[t._v("<template>")]),t._v(" 和 "),n("code",[t._v("<slot>")]),t._v(" 元素，用于编写不在页面中显示的标记模板。")]),t._v(" "),n("li",[t._v("HTML Imports，用于引入自定义组件。")])]),t._v(" "),n("p",[t._v("每个组件由 "),n("code",[t._v("link")]),t._v(" 标签引入：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<link rel="import" href="components/di-li.html">\n<link rel="import" href="components/d-header.html">\n')])])]),n("p",[t._v("随后，在各自的 HTML 文件里，创建相应的组件元素，编写相应的组件逻辑。一个典型的 Web Components 应用架构如下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(332),alt:"Web Components 架构"}})]),t._v(" "),n("p",[t._v("可以看到这边方式与我们上面使用 iframe 的方式很相似，组件拥有自己独立的 "),n("code",[t._v("Scripts")]),t._v(" 和 "),n("code",[t._v("Styles")]),t._v("，以及对应的用于单独部署组件的域名。然而它并没有想象中的那么美好，要直接使用"),n("strong",[t._v("纯")]),t._v(" Web Components 来构建前端应用的难度有：")]),t._v(" "),n("ul",[n("li",[t._v("重写现有的前端应用。是的，现在我们需要完成使用 Web Components 来完成整个系统的功能。")]),t._v(" "),n("li",[t._v("上下游生态系统不完善。缺乏相应的一些第三方控件支持，这也是为什么 jQuery 相当流行的原因。")]),t._v(" "),n("li",[t._v("系统架构复杂。当应用被拆分为一个又一个的组件时，组件间的通讯就成了一个特别大的麻烦。")])]),t._v(" "),n("p",[t._v("Web Components 中的 ShadowDOM 更像是新一代的前端 DOM 容器。而遗憾的是并不是所有的浏览器，都可以完全支持 Web Components。")]),t._v(" "),n("h2",{attrs:{id:"结合-web-components-构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结合-web-components-构建"}},[t._v("#")]),t._v(" 结合 Web Components 构建")]),t._v(" "),n("p",[t._v("Web Components 离现在的我们太远，可是结合 Web Components 来构建前端应用，则更是一种面向未来演进的架构。或者说在未来的时候，我们可以开始采用这种方式来构建我们的应用。好在，已经有框架在打造这种可能性。")]),t._v(" "),n("p",[t._v("就当前而言，有两种方式可以结合 Web Components 来构建微前端应用：")]),t._v(" "),n("ul",[n("li",[t._v("使用 Web Components 构建独立于框架的组件，随后在对应的框架中引入这些组件")]),t._v(" "),n("li",[t._v("在 Web Components 中引入现有的框架，类似于 iframe 的形式")])]),t._v(" "),n("p",[t._v("前者是一种组件式的方式，或者则像是在迁移未来的 “遗留系统” 到未来的架构上。")]),t._v(" "),n("h3",{attrs:{id:"在-web-components-中集成现有框架"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在-web-components-中集成现有框架"}},[t._v("#")]),t._v(" 在 Web Components 中集成现有框架")]),t._v(" "),n("p",[t._v("现有的 Web 框架已经有一些可以支持 Web Components 的形式，诸如 Angular 支持的 createCustomElement，就可以实现一个 Web Components 形式的组件：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("platformBrowser()\n  .bootstrapModuleFactory(MyPopupModuleNgFactory)\n    .then(({injector}) => {\n      const MyPopupElement = createCustomElement(MyPopup, {injector});\n      customElements.define(‘my-popup’, MyPopupElement);\n});\n")])])]),n("p",[t._v("在未来，将有更多的框架可以使用类似这样的形式，集成到 Web Components 应用中。")]),t._v(" "),n("h3",{attrs:{id:"集成在现有框架中的-web-components"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集成在现有框架中的-web-components"}},[t._v("#")]),t._v(" 集成在现有框架中的 Web Components")]),t._v(" "),n("p",[t._v("另外一种方式，则是类似于 "),n("a",{attrs:{href:"https://github.com/ionic-team/stencil",target:"_blank",rel:"noopener noreferrer"}},[t._v("Stencil"),n("OutboundLink")],1),t._v(" 的形式，将组件直接构建成 Web Components 形式的组件，随后在对应的诸如，如 React 或者 Angular 中直接引用。")]),t._v(" "),n("p",[t._v("如下是一个在 React 中引用 Stencil 生成的 Web Components 的例子：")]),t._v(" "),n("div",{staticClass:"language-javascriptA extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport registerServiceWorker from './registerServiceWorker';\n\nimport 'test-components/testcomponents';\n\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n")])])]),n("p",[t._v("在这种情况之下，我们就可以构建出独立于框架的组件。")]),t._v(" "),n("p",[t._v("同样的 Stencil 仍然也只是支持最近的一些浏览器，比如：Chrome、Safari、Firefox、Edge 和 IE11")]),t._v(" "),n("h2",{attrs:{id:"复合型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复合型"}},[t._v("#")]),t._v(" 复合型")]),t._v(" "),n("p",[n("strong",[t._v("复合型")]),t._v("，对就是上面的几个类别中，随便挑几种组合到一起。")]),t._v(" "),n("p",[t._v("我就不废话了~~。")]),t._v(" "),n("h1",{attrs:{id:"微前端架构选型指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端架构选型指南"}},[t._v("#")]),t._v(" 微前端架构选型指南")]),t._v(" "),n("p",[t._v("在上一节《实施前端微服务化的六七种方式》中，介绍了在实施微前端的过程中，我们采用的一些不同方案的架构方案。在这篇文章中，我将总结如何依据不同的情况来选择合适的方案。")]),t._v(" "),n("h2",{attrs:{id:"快速选型指南图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速选型指南图"}},[t._v("#")]),t._v(" 快速选型指南图")]),t._v(" "),n("p",[t._v("我还是直接先给结论：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(307),alt:"微前端选型指南"}})]),t._v(" "),n("p",[t._v("关键点的相关解释如下：")]),t._v(" "),n("p",[n("strong",[t._v("框架限制")]),t._v("。在后台微服务系统里，人们使用其它语言的库来开发新的服务，如用于人工智能的 Python。但是在前端，几乎不存在这种可能性。所以当我们的前端框架只有一个时，我们在采用微前端的技术时，可选范围就更大了。而遗憾的是，多数组织需要兼容遗留系统。")]),t._v(" "),n("p",[n("strong",[t._v("IE 问题")]),t._v("。不论是在几年前，还是在今年，我们实施微前端最先考虑的就是对于 IE 的支持。在我遇到的项目上，基本上都需要支持 IE，因此在技术选型上就受限一定的限制。而在我们那些不需要支持 IE 的项目上，他们就可以使用 WebComponents 技术来构建微前端应用。")]),t._v(" "),n("p",[n("strong",[t._v("依赖独立")]),t._v("。即各个微前端应用的依赖是要统一管理，还是要在各个应该中自己管理。统一管理可以解决重复加载依赖的问题，独立管理会带来额外的流量开销和等待时间。")]),t._v(" "),n("h2",{attrs:{id:"微前端方案的对比-简要对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端方案的对比-简要对比"}},[t._v("#")]),t._v(" 微前端方案的对比：简要对比")]),t._v(" "),n("p",[t._v("如果你对上述的几个方面，仍然不是很熟悉的话，请阅读《实施前端微服务化的六七种方式》。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方式")]),t._v(" "),n("th",[t._v("开发成本")]),t._v(" "),n("th",[t._v("维护成本")]),t._v(" "),n("th",[t._v("可行性")]),t._v(" "),n("th",[t._v("同一框架要求")]),t._v(" "),n("th",[t._v("实现难度")]),t._v(" "),n("th",[t._v("潜在风险")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("路由分发")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★")]),t._v(" "),n("td",[t._v("这个方案太普通了")])]),t._v(" "),n("tr",[n("td",[t._v("iFrame")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★")]),t._v(" "),n("td",[t._v("这个方案太普通了")])]),t._v(" "),n("tr",[n("td",[t._v("应用微服务化")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★★★★")]),t._v(" "),n("td",[t._v("针对每个框架做定制及 Hook")])]),t._v(" "),n("tr",[n("td",[t._v("微件化")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("是")]),t._v(" "),n("td",[t._v("★★★★★")]),t._v(" "),n("td",[t._v("针对构建系统，如 webpack 进行 hack")])]),t._v(" "),n("tr",[n("td",[t._v("微应用化")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("是")]),t._v(" "),n("td",[t._v("★★★")]),t._v(" "),n("td",[t._v("统一不同应用的构建规范")])]),t._v(" "),n("tr",[n("td",[t._v("纯 Web Components")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★★")]),t._v(" "),n("td",[t._v("新技术，浏览器的兼容问题")])]),t._v(" "),n("tr",[n("td",[t._v("结合 Web Components")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★★")]),t._v(" "),n("td",[t._v("新技术，浏览器的兼容问题")])])])]),t._v(" "),n("p",[t._v("同样的，一些复杂概念的解释如下：")]),t._v(" "),n("p",[n("strong",[t._v("应用微服务化")]),t._v("，即每个前端应用一个独立的服务化前端应用，并配套一套统一的应用管理和启动机制，诸如微前端框架 Single-SPA 或者 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("mooa"),n("OutboundLink")],1),t._v(" 。")]),t._v(" "),n("p",[n("strong",[t._v("微件化")]),t._v("，即通过对构建系统的 hack，使不同的前端应用可以使用同一套依赖。它在"),n("strong",[t._v("应用微服务化")]),t._v("的基本上，改进了重复加载依赖文件的问题。")]),t._v(" "),n("p",[n("strong",[t._v("微应用化")]),t._v("，又可以称之为"),n("strong",[t._v("组合式集成")]),t._v("，即通过软件工程的方式，在开发环境对单体应用进行拆分，在构建环境将应用组合在一起构建成一个应用。详细的细节，可以期待后面的文章《一个单体前端应用的拆解与微服务化》")]),t._v(" "),n("h2",{attrs:{id:"微前端方案的对比-复杂方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端方案的对比-复杂方式"}},[t._v("#")]),t._v(" 微前端方案的对比：复杂方式")]),t._v(" "),n("p",[t._v("之前看到一篇微服务相关的 "),n("a",{attrs:{href:"https://www.softwarearchitekt.at/post/2017/12/28/a-software-architect-s-approach-towards-using-angular-and-spas-in-general-for-microservices-aka-microfrontends.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("文章"),n("OutboundLink")],1),t._v("，介绍了不同微服务的区别，其采用了一种比较有意思的对比方式特别详细，这里就使用同样的方式来展示：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("架构目标")]),t._v(" "),n("th",[t._v("描述")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("a. 独立开发")]),t._v(" "),n("td",[t._v("独立开发，而不受影响")])]),t._v(" "),n("tr",[n("td",[t._v("b. 独立部署")]),t._v(" "),n("td",[t._v("能作为一个服务来单独部署")])]),t._v(" "),n("tr",[n("td",[t._v("c. 支持不同框架")]),t._v(" "),n("td",[t._v("可以同时使用不同的框架，如 Angular、Vue、React")])]),t._v(" "),n("tr",[n("td",[t._v("d. 摇树优化")]),t._v(" "),n("td",[t._v("能消除未使用的代码")])]),t._v(" "),n("tr",[n("td",[t._v("e. 环境隔离")]),t._v(" "),n("td",[t._v("应用间的上下文不受干扰")])]),t._v(" "),n("tr",[n("td",[t._v("f. 多个应用同时运行")]),t._v(" "),n("td",[t._v("不同应用可以同时运行")])]),t._v(" "),n("tr",[n("td",[t._v("g. 共用依赖")]),t._v(" "),n("td",[t._v("不同应用是否共用底层依赖库")])]),t._v(" "),n("tr",[n("td",[t._v("h. 依赖冲突")]),t._v(" "),n("td",[t._v("依赖的不同版本是否导致冲突")])]),t._v(" "),n("tr",[n("td",[t._v("i. 集成编译")]),t._v(" "),n("td",[t._v("应用最后被编译成一个整体，而不是分开构建")])])])]),t._v(" "),n("p",[t._v("那么，对于下表而言，表中的 a~j 分别表示上面的几种不同的架构考虑因素。")]),t._v(" "),n("p",[t._v("（PS：考虑到  Web Components 几个单词的长度，暂时将它简称为 WC~~)")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方式")]),t._v(" "),n("th",[t._v("a")]),t._v(" "),n("th",[t._v("b")]),t._v(" "),n("th",[t._v("c")]),t._v(" "),n("th",[t._v("d")]),t._v(" "),n("th",[t._v("e")]),t._v(" "),n("th",[t._v("f")]),t._v(" "),n("th",[t._v("g")]),t._v(" "),n("th",[t._v("h")]),t._v(" "),n("th",[t._v("i")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("路由分发")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("iFrame")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("应用微服务化")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("微件化")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("微应用化")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")])]),t._v(" "),n("tr",[n("td",[t._v("纯 WC")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")])]),t._v(" "),n("tr",[n("td",[t._v("结合 WC")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")])])])]),t._v(" "),n("p",[t._v("图中的 O 表示支持，空白表示不支持，- 表示不受影响。")]),t._v(" "),n("p",[t._v("再结合之前的选型指南：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(307),alt:"微前端选型指南"}})]),t._v(" "),n("p",[t._v("（PS：本图采用 Keynote 绘制）")]),t._v(" "),n("p",[t._v("你是否找到你想到的架构了？")]),t._v(" "),n("h1",{attrs:{id:"如何解构单体前端应用-前端应用的微服务式拆分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何解构单体前端应用-前端应用的微服务式拆分"}},[t._v("#")]),t._v(" 如何解构单体前端应用——前端应用的微服务式拆分")]),t._v(" "),n("blockquote",[n("p",[t._v("刷新页面？路由拆分？No，动态加载组件。")])]),t._v(" "),n("p",[t._v("本文分为以下四部分：")]),t._v(" "),n("ul",[n("li",[t._v("前端微服务化思想介绍")]),t._v(" "),n("li",[t._v("微前端的设计理念")]),t._v(" "),n("li",[t._v("实战微前端架构设计")]),t._v(" "),n("li",[t._v("基于 Mooa 进行前端微服务化")])]),t._v(" "),n("h2",{attrs:{id:"前端微服化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服化"}},[t._v("#")]),t._v(" 前端微服化")]),t._v(" "),n("p",[t._v("对于前端微服化来说，有这么一些方案：")]),t._v(" "),n("ul",[n("li",[t._v("Web Component 显然可以一个很优秀的基础架构。然而，我们并不可能去大量地复写已有的应用。")]),t._v(" "),n("li",[t._v("iFrame。你是说真的吗？")]),t._v(" "),n("li",[t._v("另外一个微前端框架 Single-SPA，显然是一个更好的方式。然而，它并非 Production Ready。")]),t._v(" "),n("li",[t._v("通过路由来切分应用，而这个跳转会影响用户体验。")]),t._v(" "),n("li",[t._v("等等。")])]),t._v(" "),n("p",[t._v("因此，当我们考虑前端微服务化的时候，我们希望：")]),t._v(" "),n("ul",[n("li",[t._v("独立部署")]),t._v(" "),n("li",[t._v("独立开发")]),t._v(" "),n("li",[t._v("技术无关")]),t._v(" "),n("li",[t._v("不影响用户体验")])]),t._v(" "),n("h3",{attrs:{id:"独立开发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立开发"}},[t._v("#")]),t._v(" 独立开发")]),t._v(" "),n("p",[t._v("在过去的几星期里，我花费了大量的时间在学习 Single-SPA 的代码。但是，我发现它在开发和部署上真的太麻烦了，完全达不到独立部署地标准。按 Single-SPA 的设计，我需要在入口文件中声名我的应用，然后才能去构建：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("declareChildApplication('inferno', () => import('src/inferno/inferno.app.js'), pathPrefix('/inferno'));\n")])])]),n("p",[t._v("同时，在我的应用里，我还需要去指定我的生命周期。这就意味着，当我开发了一个新的应用时，必须更新两份代码：主工程和应用。这时我们还极可能在同一个源码里工作。")]),t._v(" "),n("p",[t._v("当出现多个团队的时候，在同一份源码里工作，显然变得相当的不可靠——比如说，对方团队使用的是 Tab，而我们使用的是 2 个空格，隔壁的老王用的是 4 个空格。")]),t._v(" "),n("h3",{attrs:{id:"独立部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立部署"}},[t._v("#")]),t._v(" 独立部署")]),t._v(" "),n("p",[t._v("一个单体的前端应用最大的问题是，构建出来的 js、css 文件相当的巨大。而微前端则意味着，这个文件被独立地拆分成多个文件，它们便可以独立去部署应用。")]),t._v(" "),n("h3",{attrs:{id:"我们真的需要技术无关吗"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我们真的需要技术无关吗"}},[t._v("#")]),t._v(" 我们真的需要技术无关吗？")]),t._v(" "),n("p",[t._v("等等，我们是否真的需要"),n("strong",[t._v("技术无关")]),t._v("？如果我们不需要技术无关的话，微前端问题就很容易解决了。")]),t._v(" "),n("p",[t._v("事实上，对于大部分的公司和团队来说，技术无关只是一个无关痛痒的话术。当一家公司的几个创始人使用了 Java，那么极有可能在未来的选型上继续使用 Java。除非，一些额外的服务来使用 Python 来实现人工智能。因此，在大部分的情况下，仍然是技术栈唯一。")]),t._v(" "),n("p",[t._v("对于前端项目来说，更是如此：一个部门里基本上只会选用一个框架。")]),t._v(" "),n("p",[t._v("于是，我们选择了 Angular。")]),t._v(" "),n("h3",{attrs:{id:"不影响用户体验"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不影响用户体验"}},[t._v("#")]),t._v(" 不影响用户体验")]),t._v(" "),n("p",[t._v("使用路由跳转来进行前端微服务化，是一种很简单、高效的切分方式。然而，路由跳转地过程中，会有一个白屏的过程。在这个过程中，跳转前的应用和将要跳转的应用，都失去了对页面的控制权。如果这个应用出了问题，那么用户就会一脸懵逼。")]),t._v(" "),n("p",[t._v("理想的情况下，它应该可以被控制。")]),t._v(" "),n("h2",{attrs:{id:"微前端的设计理念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端的设计理念"}},[t._v("#")]),t._v(" 微前端的设计理念")]),t._v(" "),n("h3",{attrs:{id:"设计理念一-中心化路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念一-中心化路由"}},[t._v("#")]),t._v(" 设计理念一：中心化路由")]),t._v(" "),n("p",[t._v("互联网本质是去中心化的吗？不，DNS 决定了它不是。TAB，决定了它不是。")]),t._v(" "),n("p",[t._v("微服务从本质上来说，它应该是去中心化的。但是，它又不能是完全的去中心化。对于一个微服务来说，它需要一个"),n("strong",[t._v("服务注册中心")]),t._v("：")]),t._v(" "),n("blockquote",[n("p",[t._v("服务提供方要注册通告服务地址，服务的调用方要能发现目标服务。")])]),t._v(" "),n("p",[t._v("对于一个前端应用来说，这个东西就是路由。")]),t._v(" "),n("p",[t._v("从页面上来说，只有我们在网页上添加一个菜单链接，用户才能知道某个页面是可以使用的。")]),t._v(" "),n("p",[t._v("而从代码上来说，那就是我们需要有一个地方来管理我们的应用：**发现存在哪些应用，哪个应用使用哪个路由。")]),t._v(" "),n("p",[n("strong",[t._v("管理好我们的路由，实际上就是管理好我们的应用")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"设计理念二-标识化应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念二-标识化应用"}},[t._v("#")]),t._v(" 设计理念二：标识化应用")]),t._v(" "),n("p",[t._v("在设计一个微前端框架的时候，为"),n("strong",[t._v("每个项目取一个名字的")]),t._v("问题纠结了我很久——怎么去规范化这个东西。直到，我再一次想到了康威定律：")]),t._v(" "),n("blockquote",[n("p",[t._v("系统设计(产品结构等同组织形式，每个设计系统的组织，其产生的设计等同于组织之间的沟通结构。")])]),t._v(" "),n("p",[t._v("换句人话说，就是同一个组织下，不可能有两个项目的名称是一样的。")]),t._v(" "),n("p",[t._v("所以，这个问题很简单就解决了。")]),t._v(" "),n("h3",{attrs:{id:"设计理念三-生命周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念三-生命周期"}},[t._v("#")]),t._v(" 设计理念三：生命周期")]),t._v(" "),n("p",[t._v("Single-SPA 设计了一个基本的生命周期（虽然它没有统一管理），它包含了五种状态：")]),t._v(" "),n("ul",[n("li",[t._v("load，决定加载哪个应用，并绑定生命周期")]),t._v(" "),n("li",[t._v("bootstrap，获取静态资源")]),t._v(" "),n("li",[t._v("mount，安装应用，如创建 DOM 节点")]),t._v(" "),n("li",[t._v("unload，删除应用的生命周期")]),t._v(" "),n("li",[t._v("unmount，卸载应用，如删除 DOM 节点")])]),t._v(" "),n("p",[t._v("于是，我在设计上基本上沿用了这个生命周期。显然，诸如 load 之类对于我的设计是多余的。")]),t._v(" "),n("h3",{attrs:{id:"设计理念四-独立部署与配置自动化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念四-独立部署与配置自动化"}},[t._v("#")]),t._v(" 设计理念四：独立部署与配置自动化")]),t._v(" "),n("p",[t._v("从某种意义上来说，整个每系统是围绕着应用配置进行的。如果应用的配置能自动化，那么整个系统就自动化。")]),t._v(" "),n("p",[t._v("当我们只开发一个新的组件，那么我们只需要更新我们的组件，并更新配置即可。而这个配置本身也应该是能自动生成的。")]),t._v(" "),n("h2",{attrs:{id:"实战微前端架构设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实战微前端架构设计"}},[t._v("#")]),t._v(" 实战微前端架构设计")]),t._v(" "),n("p",[t._v("基于以上的前提，系统的工作流程如下所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(308),alt:"系统工作流"}})]),t._v(" "),n("p",[t._v("整体的工程流程如下所示：")]),t._v(" "),n("ol",[n("li",[t._v("主工程在运行的时候，会去服务器获取最新的应用配置。")]),t._v(" "),n("li",[t._v("主工程在获取到配置后，将一一创建应用，并为应用绑定生命周期。")]),t._v(" "),n("li",[t._v("当主工程监测到路由变化的时候，将寻找是否有对应的路由匹配到应用。")]),t._v(" "),n("li",[t._v("当匹配对对应应用时，则加载相应的应用。")])]),t._v(" "),n("p",[t._v("故而，其对应的结构下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(309),alt:"Architecture"}})]),t._v(" "),n("p",[t._v("整体的流程如下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(333),alt:"Workflow"}})]),t._v(" "),n("h3",{attrs:{id:"独立部署与配置自动化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立部署与配置自动化"}},[t._v("#")]),t._v(" 独立部署与配置自动化")]),t._v(" "),n("p",[t._v("我们做的部署策略如下：我们的应用使用的配置文件叫 "),n("code",[t._v("apps.json")]),t._v("，由主工程去获取这个配置。每次部署的时候，我们只需要将 "),n("code",[t._v("apps.json")]),t._v(" 指向最新的配置文件即可。配置的文件类如下所示：")]),t._v(" "),n("ol",[n("li",[t._v("96a7907e5488b6bb.json")]),t._v(" "),n("li",[t._v("6ff3bfaaa2cd39ea.json")]),t._v(" "),n("li",[t._v("dcd074685c97ab9b.json")])]),t._v(" "),n("p",[t._v("一个应用的配置如下所示：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selector"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help-root"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baseScriptUrl"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/assets/help"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"styles"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"styles.bundle.css"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prefix"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scripts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"inline.bundle.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"polyfills.bundle.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main.bundle.js"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这里的 "),n("code",[t._v("selector")]),t._v(" 对应于应用所需要的 DOM 节点，prefix 则是用于 URL 路由上。这些都是自动从 "),n("code",[t._v("index.html")]),t._v(" 文件和 "),n("code",[t._v("package.json")]),t._v(" 中获取生成的。")]),t._v(" "),n("h3",{attrs:{id:"应用间路由-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用间路由-事件"}},[t._v("#")]),t._v(" 应用间路由——事件")]),t._v(" "),n("p",[t._v("由于现在的应用变成了两部分：主工程和应用部分。就会出现一个问题："),n("strong",[t._v("只有一个工程能捕获路由变化")]),t._v("。当由主工程去改变应用的二级路由时，就无法有效地传达到子应用。在这时，只能通过事件的方式去通知子应用，子应用也需要监测是否是当前应用的路由。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" appName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" urlPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("urlPrefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    urlPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("option"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urlPrefix"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("navigate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("urlPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" appName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("相似的，当我们需要从应用 A 跳转到应用 B 时，我们也需要这样的一个机制：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("window.addEventListener('mooa.routing.navigate', function(event: CustomEvent) {\n  const opts = event.detail\n  if (opts) {\n    navigateAppByName(opts)\n  }\n})\n")])])]),n("p",[t._v("剩下的诸如 Loading 动画也是类似的。")]),t._v(" "),n("h1",{attrs:{id:"大型-angular-应用微前端的四种拆分策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#大型-angular-应用微前端的四种拆分策略"}},[t._v("#")]),t._v(" 大型 Angular 应用微前端的四种拆分策略")]),t._v(" "),n("p",[t._v("上一个月，我们花了大量的时间不熂设计方案来拆分一个大型的 Angular 应用。从使用 Angular 的 Lazyload 到前端微服务化，进行了一系列的讨论。最后，我们终于有了结果，采用的是 Lazyload 变体："),n("strong",[t._v("构建时集成代码")]),t._v(" 的方式。")]),t._v(" "),n("p",[t._v("过去的几周里，作为一个 “专业” 的咨询师，一直忙于在为客户设计一个 Angular 拆分的服务化方案。主要是为了达成以下的设计目标：")]),t._v(" "),n("ul",[n("li",[t._v("构建插件化的 Web 开发平台，满足业务快速变化及分布式多团队并行开发的需求")]),t._v(" "),n("li",[t._v("构建服务化的中间件，搭建高可用及高复用的前端微服务平台")]),t._v(" "),n("li",[t._v("支持前端的独立交付及部署")])]),t._v(" "),n("p",[t._v("简单地来说，就是要支持"),n("strong",[t._v("应用插件化开发")]),t._v("，以及"),n("strong",[t._v("多团队并行开发")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("应用插件化开发")]),t._v("，其所要解决的主要问题是：臃肿的大型应用的拆分问题。大型前端应用，在开发的时候要面临大量的"),n("strong",[t._v("遗留代码")]),t._v("、不同业务的代码耦合在一起，在线上的时候还要面临加载速度慢，运行效率低的问题。")]),t._v(" "),n("p",[t._v("最后就落在了两个方案上：路由懒加载及其变体与前端微服务化")]),t._v(" "),n("h2",{attrs:{id:"前端微服务化-路由懒加载及其变体"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化-路由懒加载及其变体"}},[t._v("#")]),t._v(" 前端微服务化：路由懒加载及其变体")]),t._v(" "),n("p",[t._v("路由懒加载，即通过不同的路由来将应用切成不同的代码快，当路由被访问的时候，才加载对应组件。在诸如 Angular、Vue 框架里都可以通过路由 +  Webpack 打包的方式来实现。而，不可避免地就会需要一些问题：")]),t._v(" "),n("p",[n("strong",[t._v("难以多团队并行开发")]),t._v("，路由拆分就意味着我们仍然是在一个源码库里工作的。也可以尝试拆分成不同的项目，再编译到一起。")]),t._v(" "),n("p",[n("strong",[t._v("每次发布需要重新编译")]),t._v("，是的，当我们只是更新一个子模块的代码，我们要重新编译整个应用，再重新发布这个应用。而不能独立地去构建它，再发布它。")]),t._v(" "),n("p",[n("strong",[t._v("统一的 Vendor 版本")]),t._v("，统一第三方依赖是一件好事。可问题的关键在于：每当我们添加一个新的依赖，我们可能就需要开会讨论一下。")]),t._v(" "),n("p",[t._v("然而，标准 Route Lazyload 最大的问题就是"),n("strong",[t._v("难以多团队并行开发")]),t._v("，这里之所以说的是 “难以” 是因为，还是有办法解决这个问题。在日常的开发中，一个小的团队会一直在一个代码库里开发，而一个大的团队则应该是在不同的代码库里开发。")]),t._v(" "),n("p",[t._v("于是，我们在标准的路由懒加载之上做了一些尝试。")]),t._v(" "),n("p",[t._v("对于一个二三十人规模的团队来说，他们可能在业务上归属于不同的部门，技术上也有一些不一致的规范，如 4 个空格、2 个空格还是使用 Tab 的问题。特别是当它是不同的公司和团队时，他们可能要放弃测试、代码静态检测、代码风格统一等等的一系列问题。")]),t._v(" "),n("h2",{attrs:{id:"微服务化方案-子应用模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微服务化方案-子应用模式"}},[t._v("#")]),t._v(" 微服务化方案：子应用模式")]),t._v(" "),n("p",[t._v("除了路由懒加载，我们还可以采用子应用模式，即每个应用都是相互独立地。即我们有一个基座工程，当用户点击相应的路由时，我们去加载这个"),n("strong",[t._v("独立")]),t._v(" 的 Angular 应用；如果是同一个应用下的路由，就不需要重复加载了。而且，这些都可以依赖于浏览器缓存来做。")]),t._v(" "),n("p",[t._v("除了路由懒加载，还可以采用的是类似于 Mooa 的应用嵌入方案。如下是基于 Mooa 框架 + Angular 开发而生成的 HTML 示例：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<app-root _nghost-c0="" ng-version="4.2.0">\n  ...\n  <app-home _nghost-c2="">\n    <app-app1 _nghost-c0="" ng-version="5.2.8" style="display: none;"><nav _ngcontent-c0="" class="navbar"></app-app1>\n    <iframe frameborder="" width="100%" height="100%" src="http://localhost:4200/app/help/homeassets/iframe.html" id="help_206547"></iframe>\n  </app-home>\n</app-root>\n')])])]),n("p",[t._v("Mooa 提供了两种模式，一种是基于 Single-SPA 的实验做的，在同一页面加载、渲染两个 Angular 应用；一种是基于 iFrame 来提供独立的应用容器。")]),t._v(" "),n("p",[t._v("解决了以下的问题：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("首页加载速度更快")]),t._v("，因为只需要加载首页所需要的功能，而不是所有的依赖。")]),t._v(" "),n("li",[n("strong",[t._v("多个团队并行开发")]),t._v("，每个团队里可以独立地在自己的项目里开发。")]),t._v(" "),n("li",[n("strong",[t._v("独立地进行模块化更新")]),t._v("，现在我们只需要去单独更新我们的应用，而不需要更新整个完整的应用。")])]),t._v(" "),n("p",[t._v("但是，它仍然包含有以下的问题：")]),t._v(" "),n("ul",[n("li",[t._v("重复加载依赖项，即我们在 A 应用中使用到的模块，在 B 应用中也会重新使用到。有一部分可以通过浏览器的缓存来自动解决。")]),t._v(" "),n("li",[t._v("第一次打开对应的应用需要时间，当然"),n("strong",[t._v("预加载")]),t._v("可以解决一部分问题。")]),t._v(" "),n("li",[t._v("在非 iframe 模式下运行，会遇到难以预料的第三方依赖冲突。")])]),t._v(" "),n("p",[t._v("于是在总结了一系列的讨论之后，我们形成了一系列的对比方案：")]),t._v(" "),n("h2",{attrs:{id:"方案对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案对比"}},[t._v("#")]),t._v(" 方案对比")]),t._v(" "),n("p",[t._v("在这个过程中，我们做了大量的方案设计与对比，便想写一篇文章对比一下之前的结果。先看一下图：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(306),alt:"Angular 代码拆分对比"}})]),t._v(" "),n("p",[t._v("表格对比：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("x")]),t._v(" "),n("th",[t._v("标准 Lazyload")]),t._v(" "),n("th",[t._v("构建时集成")]),t._v(" "),n("th",[t._v("构建后集成")]),t._v(" "),n("th",[t._v("应用独立")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("开发流程")]),t._v(" "),n("td",[t._v("多个团队在同一个代码库里开发")]),t._v(" "),n("td",[t._v("多个团队在不同的代码库里开发")]),t._v(" "),n("td",[t._v("多个团队在不同的代码库里开发")]),t._v(" "),n("td",[t._v("多个团队在不同的代码库里开发")])]),t._v(" "),n("tr",[n("td",[t._v("构建与发布")]),t._v(" "),n("td",[t._v("构建时只需要拿这一份代码去构建、部署")]),t._v(" "),n("td",[t._v("将不同代码库的代码整合到一起，再构建应用")]),t._v(" "),n("td",[t._v("将直接编译成各个项目模块，运行时通过懒加载合并")]),t._v(" "),n("td",[t._v("将直接编译成不同的几个应用，运行时通过主工程加载")])]),t._v(" "),n("tr",[n("td",[t._v("适用场景")]),t._v(" "),n("td",[t._v("单一团队，依赖库少、业务单一")]),t._v(" "),n("td",[t._v("多团队，依赖库少、业务单一")]),t._v(" "),n("td",[t._v("多团队，依赖库少、业务单一")]),t._v(" "),n("td",[t._v("多团队，依赖库多、业务复杂")])]),t._v(" "),n("tr",[n("td",[t._v("表现方式")]),t._v(" "),n("td",[t._v("开发、构建、运行一体")]),t._v(" "),n("td",[t._v("开发分离，构建时集成，运行一体")]),t._v(" "),n("td",[t._v("开发分离，构建分离，运行一体")]),t._v(" "),n("td",[t._v("开发、构建、运行分离")])])])]),t._v(" "),n("p",[t._v("详细的介绍如下：")]),t._v(" "),n("h3",{attrs:{id:"标准-lazyload"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#标准-lazyload"}},[t._v("#")]),t._v(" 标准 LazyLoad")]),t._v(" "),n("p",[t._v("开发流程：多个团队在同一个代码库里开发，构建时只需要拿这一份代码去部署。")]),t._v(" "),n("p",[t._v("行为：开发、构建、运行一体")]),t._v(" "),n("p",[t._v("适用场景：单一团队，依赖库少、业务单一")]),t._v(" "),n("h3",{attrs:{id:"lazyload-变体-1-构建时集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lazyload-变体-1-构建时集成"}},[t._v("#")]),t._v(" LazyLoad 变体 1：构建时集成")]),t._v(" "),n("p",[t._v("开发流程：多个团队在不同的代码库里开发，在构建时将不同代码库的代码整合到一起，再去构建这个应用。")]),t._v(" "),n("p",[t._v("适用场景：多团队，依赖库少、业务单一")]),t._v(" "),n("p",[t._v("变体-构建时集成：开发分离，构建时集成，运行一体")]),t._v(" "),n("h3",{attrs:{id:"lazyload-变体-2-构建后集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lazyload-变体-2-构建后集成"}},[t._v("#")]),t._v(" LazyLoad 变体 2：构建后集成")]),t._v(" "),n("p",[t._v("开发流程：多个团队在不同的代码库里开发，在构建时将编译成不同的几份代码，运行时会通过懒加载合并到一起。")]),t._v(" "),n("p",[t._v("适用场景：多团队，依赖库少、业务单一")]),t._v(" "),n("p",[t._v("变体-构建后集成：开发分离，构建分离，运行一体")]),t._v(" "),n("h3",{attrs:{id:"前端微服务化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化"}},[t._v("#")]),t._v(" 前端微服务化")]),t._v(" "),n("p",[t._v("开发流程：多个团队在不同的代码库里开发，在构建时将编译成不同的几个应用，运行时通过主工程加载。")]),t._v(" "),n("p",[t._v("适用场景：多团队，依赖库多、业务复杂")]),t._v(" "),n("p",[t._v("前端微服务化：开发、构建、运行分离")]),t._v(" "),n("h2",{attrs:{id:"总对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总对比"}},[t._v("#")]),t._v(" 总对比")]),t._v(" "),n("p",[t._v("总体的对比如下表所示：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("x")]),t._v(" "),n("th",[t._v("标准 Lazyload")]),t._v(" "),n("th",[t._v("构建时集成")]),t._v(" "),n("th",[t._v("构建后集成")]),t._v(" "),n("th",[t._v("应用独立")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("依赖管理")]),t._v(" "),n("td",[t._v("统一管理")]),t._v(" "),n("td",[t._v("统一管理")]),t._v(" "),n("td",[t._v("统一管理")]),t._v(" "),n("td",[t._v("各应用独立管理")])]),t._v(" "),n("tr",[n("td",[t._v("部署方式")]),t._v(" "),n("td",[t._v("统一部署")]),t._v(" "),n("td",[t._v("统一部署")]),t._v(" "),n("td",[t._v("可单独部署。更新依赖时，需要全量部署")]),t._v(" "),n("td",[t._v("可完全独立部署")])]),t._v(" "),n("tr",[n("td",[t._v("首屏加载")]),t._v(" "),n("td",[t._v("依赖在同一个文件，加载速度慢")]),t._v(" "),n("td",[t._v("依赖在同一个文件，加载速度慢")]),t._v(" "),n("td",[t._v("依赖在同一个文件，加载速度慢")]),t._v(" "),n("td",[t._v("依赖各自管理，首页加载快")])]),t._v(" "),n("tr",[n("td",[t._v("首次加载应用、模块")]),t._v(" "),n("td",[t._v("只加载模块，速度快")]),t._v(" "),n("td",[t._v("只加载模块，速度快")]),t._v(" "),n("td",[t._v("只加载模块，速度快")]),t._v(" "),n("td",[t._v("单独加载，加载略慢")])]),t._v(" "),n("tr",[n("td",[t._v("前期构建成本")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("设计构建流程")]),t._v(" "),n("td",[t._v("设计构建流程")]),t._v(" "),n("td",[t._v("设计通讯机制与加载方式")])]),t._v(" "),n("tr",[n("td",[t._v("维护成本")]),t._v(" "),n("td",[t._v("一个代码库不好管理")]),t._v(" "),n("td",[t._v("多个代码库不好统一")]),t._v(" "),n("td",[t._v("后期需要维护组件依赖")]),t._v(" "),n("td",[t._v("后期维护成本低")])]),t._v(" "),n("tr",[n("td",[t._v("打包优化")]),t._v(" "),n("td",[t._v("可进行摇树优化、AoT 编译、删除无用代码")]),t._v(" "),n("td",[t._v("可进行摇树优化、AoT 编译、删除无用代码")]),t._v(" "),n("td",[t._v("应用依赖的组件无法确定，不能删除无用代码")]),t._v(" "),n("td",[t._v("可进行摇树优化、AoT 编译、删除无用代码")])])])]),t._v(" "),n("h1",{attrs:{id:"前端微服务化-使用微前端框架-mooa-开发微前端应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化-使用微前端框架-mooa-开发微前端应用"}},[t._v("#")]),t._v(" 前端微服务化：使用微前端框架 Mooa 开发微前端应用")]),t._v(" "),n("p",[t._v("Mooa 是一个为 Angular 服务的微前端框架，它是一个基于 "),n("a",{attrs:{href:"https://github.com/CanopyTax/single-spa",target:"_blank",rel:"noopener noreferrer"}},[t._v("single-spa"),n("OutboundLink")],1),t._v("，针对 IE 10 及 IFRAME 优化的微前端解决方案。")]),t._v(" "),n("h2",{attrs:{id:"mooa-概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mooa-概念"}},[t._v("#")]),t._v(" Mooa 概念")]),t._v(" "),n("p",[t._v("Mooa 框架与 Single-SPA 不一样的是，Mooa 采用的是 Master-Slave 架构，即主-从式设计。")]),t._v(" "),n("p",[t._v("对于 Web 页面来说，它可以同时存在两个到多个的 Angular 应用：其中的一个 Angular 应用作为主工程存在，剩下的则是子应用模块。")]),t._v(" "),n("ul",[n("li",[t._v("主工程，负责加载其它应用，及用户权限管理等核心控制功能。")]),t._v(" "),n("li",[t._v("子应用，负责不同模块的具体业务代码。")])]),t._v(" "),n("p",[t._v("在这种模式下，则由主工程来控制整个系统的行为，子应用则做出一些对应的响应。")]),t._v(" "),n("h2",{attrs:{id:"微前端主工程创建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端主工程创建"}},[t._v("#")]),t._v(" 微前端主工程创建")]),t._v(" "),n("p",[t._v("要创建微前端框架 Mooa 的主工程，并不需要多少修改，只需要使用 "),n("code",[t._v("angular-cli")]),t._v(" 来生成相应的应用：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("ng new hello-world\n")])])]),n("p",[t._v("然后添加 "),n("code",[t._v("mooa")]),t._v(" 依赖")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("yarn add mooa\n")])])]),n("p",[t._v("接着创建一个简单的配置文件 "),n("code",[t._v("apps.json")]),t._v("，放在 "),n("code",[t._v("assets")]),t._v(" 目录下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[{\n    "name": "help",\n    "selector": "app-help",\n    "baseScriptUrl": "/assets/help",\n    "styles": [\n      "styles.bundle.css"\n    ],\n    "prefix": "help",\n    "scripts": [\n      "inline.bundle.js",\n      "polyfills.bundle.js",\n      "main.bundle.js"\n    ]\n  }\n]]\n')])])]),n("p",[t._v("接着，在我们的 "),n("code",[t._v("app.component.ts")]),t._v(" 中编写相应的创建应用逻辑：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("mooa = new Mooa({\n  mode: 'iframe',\n  debug: false,\n  parentElement: 'app-home',\n  urlPrefix: 'app',\n  switchMode: 'coexist',\n  preload: true,\n  includeZone: true\n});\n\nconstructor(private renderer: Renderer2, http: HttpClient, private router: Router) {\n  http.get<IAppOption[]>('/assets/apps.json')\n    .subscribe(\n      data => {\n        this.createApps(data);\n      },\n      err => console.log(err)\n    );\n}\n\nprivate createApps(data: IAppOption[]) {\n  data.map((config) => {\n    this.mooa.registerApplication(config.name, config, mooaRouter.hashPrefix(config.prefix));\n  });\n\n  const that = this;\n  this.router.events.subscribe((event) => {\n    if (event instanceof NavigationEnd) {\n      that.mooa.reRouter(event);\n    }\n  });\n\n  return mooa.start();\n}\n")])])]),n("p",[t._v("再为应用创建一个对应的路由即可：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("{\n  path: 'app/:appName/:route',\n  component: HomeComponent\n}\n")])])]),n("p",[t._v("接着，我们就可以创建 Mooa 子应用。")]),t._v(" "),n("h2",{attrs:{id:"mooa-子应用创建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mooa-子应用创建"}},[t._v("#")]),t._v(" Mooa 子应用创建")]),t._v(" "),n("p",[t._v("Mooa 官方提供了一个子应用的模块，直接使用该模块即可：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("git clone https://github.com/phodal/mooa-boilerplate\n")])])]),n("p",[t._v("然后执行：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("npm install\n")])])]),n("p",[t._v("在安装完依赖后，会进行项目的初始化设置，如更改包名等操作。在这里，将我们的应用取名为 help。")]),t._v(" "),n("p",[t._v("然后，我们就可以完成子应用的构建。")]),t._v(" "),n("p",[t._v("接着，执行："),n("code",[t._v("yarn build")]),t._v(" 就可以构建出我们的应用。")]),t._v(" "),n("p",[t._v("将 "),n("code",[t._v("dist")]),t._v(" 目录一下的文件拷贝到主工程的 src/assets/help 目录下，再启动主工程即可。")]),t._v(" "),n("h2",{attrs:{id:"导航到特定的子应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#导航到特定的子应用"}},[t._v("#")]),t._v(" 导航到特定的子应用")]),t._v(" "),n("p",[t._v("在 Mooa 中，有一个路由接口 "),n("code",[t._v("mooaPlatform.navigateTo")]),t._v("，具体使用情况如下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("mooaPlatform.navigateTo({\n  appName: 'help',\n  router: 'home'\n});\n")])])]),n("p",[t._v("它将触发一个 "),n("code",[t._v("MOOA_EVENT.ROUTING_NAVIGATE")]),t._v(" 事件。而在我们调用 "),n("code",[t._v("mooa.start()")]),t._v(" 方法时，则会开发监听对应的事件：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("window.addEventListener(MOOA_EVENT.ROUTING_NAVIGATE, function(event: CustomEvent) {\n  if (event.detail) {\n    navigateAppByName(event.detail)\n  }\n})\n")])])]),n("p",[t._v("它将负责将应用导向新的应用。")]),t._v(" "),n("p",[t._v("嗯，就是这么简单。DEMO 视频如下：")]),t._v(" "),n("p",[t._v("Demo 地址见："),n("a",{attrs:{href:"http://mooa.phodal.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://mooa.phodal.com/"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("GitHub 示例："),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/phodal/mooa"),n("OutboundLink")],1)]),t._v(" "),n("h1",{attrs:{id:"前端微服务化-使用特制的-iframe-微服务化-angular-应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化-使用特制的-iframe-微服务化-angular-应用"}},[t._v("#")]),t._v(" 前端微服务化：使用特制的 iframe 微服务化 Angular 应用")]),t._v(" "),n("p",[t._v("Angular 基于 Component 的思想，可以让其在一个页面上同时运行多个 Angular 应用；可以在一个 DOM 节点下，存在多个 Angular 应用，即类似于下面的形式：")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-home")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c3")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-help")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_ngcontent-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-help")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-app1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("nav")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_ngcontent-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("navbar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-app1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-app2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("nav")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_ngcontent-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("navbar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-app2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-home")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("可这一样一来，难免需要做以下的一些额外的工作：")]),t._v(" "),n("ul",[n("li",[t._v("创建子应用项目模板，以统一 Angular 版本")]),t._v(" "),n("li",[t._v("构建时，删除子应用的依赖")]),t._v(" "),n("li",[t._v("修改第三方模块")])]),t._v(" "),n("p",[t._v("而在这其中最麻烦的就是"),n("strong",[t._v("第三方模块")]),t._v("冲突问题。思来想去，在三月中旬，我在 Mooa 中添加了一个 iframe 模式。")]),t._v(" "),n("h2",{attrs:{id:"iframe-微服务架构设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#iframe-微服务架构设计"}},[t._v("#")]),t._v(" iframe 微服务架构设计")]),t._v(" "),n("p",[t._v("在这里，总的设计思想和之前的《"),n("a",{attrs:{href:"https://www.phodal.com/blog/how-to-build-a-microfrontend-framework-mooa/",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何解构单体前端应用——前端应用的微服务式拆分"),n("OutboundLink")],1),t._v("》中介绍是一致的：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(308),alt:"Mooa 架构"}})]),t._v(" "),n("p",[t._v("主要过程如下：")]),t._v(" "),n("ul",[n("li",[t._v("主工程在运行的时候，会去服务器获取最新的应用配置。")]),t._v(" "),n("li",[t._v("主工程在获取到配置后，将一一创建应用，并为应用绑定生命周期。")]),t._v(" "),n("li",[t._v("当主工程监测到路由变化的时候，将寻找是否有对应的路由匹配到应用。")]),t._v(" "),n("li",[t._v("当匹配对对应应用时，则"),n("strong",[t._v("创建或显示相应应用的 iframe")]),t._v("，并隐藏其它子应用的 iframe。")])]),t._v(" "),n("p",[t._v("其加载形式与之前的 Component 模式并没有太大的区别：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(309),alt:"Mooa Component 加载"}})]),t._v(" "),n("p",[t._v("而为了控制不同的 iframe 需要做到这么几件事：")]),t._v(" "),n("ol",[n("li",[t._v("为不同的子应用分配 ID")]),t._v(" "),n("li",[t._v("在子应用中进行 hook，以通知主应用：子应用已加载")]),t._v(" "),n("li",[t._v("在子应用中创建对应的事件监听，来响应主应用的 URL 变化事件")]),t._v(" "),n("li",[t._v("在主应用中监听子程序的路由跳转等需求")])]),t._v(" "),n("p",[t._v("因为大部分的代码可以与之前的 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v(" 复用，于是我便在 Mooa 中实现了相应的功能。")]),t._v(" "),n("h2",{attrs:{id:"微前端框架-mooa-的特制-iframe-模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端框架-mooa-的特制-iframe-模式"}},[t._v("#")]),t._v(" 微前端框架 Mooa 的特制 iframe 模式")]),t._v(" "),n("p",[t._v("iframe 可以创建一个"),n("strong",[t._v("全新的独立的宿主环境")]),t._v("，这意味着我们的 Angular 应用之间可以相互独立运行，我们唯一要做的是："),n("strong",[t._v("建立一个通讯机制")]),t._v("。")]),t._v(" "),n("p",[t._v("它可以不修改子应用代码的情况下，可以直接使用。与此同时，它在一般的 iframe 模式进行了优化。使用普通的 iframe 模式，意味着："),n("strong",[t._v("我们需要加载大量的重复组件")]),t._v("，即使经过 Tree-Shaking 优化，它也将带来大量的重复内容。如果子应用过多，那么它在初始化应用的时候，体验可能就没有那么友好。但是与此相比，在初始化应用的时候，加载所有的依赖在主程序上，也不是一种很友好的体验。")]),t._v(" "),n("p",[t._v("于是，我就在想能不能创建一个更友好地 IFrame 模式，在里面对应用及依赖进行处理。如下，就是最后生成的页面的 iframe 代码：")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-home")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c2")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("frameborder")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("height")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://localhost:4200/assets/iframe.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("help_206547"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("frameborder")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("height")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://localhost:4200/assets/iframe.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('id="app_235458')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-home")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("对，两个 iframe 的 src 是一样的，但是它表现出来的确实是两个不同的 iframe 应用。那个 iframe.html 里面其实是没有内容的：")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("doctype")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("utf-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("App1"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("base")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width,initial-scale=1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("icon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("image/x-icon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("favicon.ico"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("（PS：详细的代码可以见 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/phodal/mooa"),n("OutboundLink")],1),t._v("）")]),t._v(" "),n("p",[t._v("只是为了创建 iframe 的需要而存在的，对于一个 Angular 应用来说，是不是一个 iframe 的区别并不大。但是，对于我们而言，区别就大了。我们可以使用自己的方式来控制这个 IFrame，以及我们所要加载的内容。如：")]),t._v(" "),n("ul",[n("li",[t._v("共同 Style Guide 中的 CSS 样式。如，在使用 iframe 集成时，移除不需要的 "),n("link")]),t._v(" "),n("li",[t._v("去除不需要重复加载的 JavaScript。如，打包时不需要的 zone.min.js、polyfill.js 等等")])]),t._v(" "),n("p",[n("code",[t._v("注意")]),t._v("：对于一些共用 UI 组件而言，仍然需要重复加载。这也就是 iframe 模式下的问题。")]),t._v(" "),n("h2",{attrs:{id:"微前端框架-mooa-iframe-通讯机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端框架-mooa-iframe-通讯机制"}},[t._v("#")]),t._v(" 微前端框架 Mooa iframe 通讯机制")]),t._v(" "),n("p",[t._v("为了在主工程与子工程通讯，我们需要做到这么一些事件策略：")]),t._v(" "),n("h3",{attrs:{id:"发布主应用事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布主应用事件"}},[t._v("#")]),t._v(" 发布主应用事件")]),t._v(" "),n("p",[t._v("由于，我们使用 Mooa 来控制 iframe 加载。这就意味着我们可以通过 "),n("code",[t._v("document.getElementById")]),t._v(" 来获取到 iframe，随后通过 "),n("code",[t._v("iframeEl.contentWindow")]),t._v(" 来发布事件，如下：")]),t._v(" "),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" iframeEl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframeId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframeEl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iframeEl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  iframeEl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("option "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("option\n  iframeEl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatchEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MOOA_EVENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ROUTING_CHANGE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" detail"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" eventArgs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这样，子应用就不需要修改代码，就可以直接接收对应的事件响应。")]),t._v(" "),n("h3",{attrs:{id:"监听子应用事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#监听子应用事件"}},[t._v("#")]),t._v(" 监听子应用事件")]),t._v(" "),n("p",[t._v("由于，我们也希望能直接在主工程中处理子程序的事件，并且不修改原有的代码。因此，我们也使用同样的方式来在子应用中监听主应用的事件：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("iframeEl.contentWindow.addEventListener(MOOA_EVENT.ROUTING_NAVIGATE, function(event: CustomEvent) {\n  if (event.detail) {\n    navigateAppByName(event.detail)\n  }\n})\n")])])]),n("h2",{attrs:{id:"示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),n("p",[t._v("同样的我们仍以 Mooa 框架作为示例，我们只需要在创建 mooa 实例时，配置使用 iframe 模式即可：")]),t._v(" "),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mooa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  mode"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  debug"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  parentElement"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app-home'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  urlPrefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  switchMode"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'coexist'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  preload"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  includeZone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\nthat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerApplicationByLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'help'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/assets/help'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mooaRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchRoute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'help'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nthat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerApplicationByLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/assets/app1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mooaRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchRoute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NavigationEnd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    that"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reRouter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("子程序则直接使用："),n("a",{attrs:{href:"https://github.com/phodal/mooa-boilerplate",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/phodal/mooa-boilerplate"),n("OutboundLink")],1),t._v(" 就可以了。")]),t._v(" "),n("h1",{attrs:{id:"资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源"}},[t._v("#")]),t._v(" 资源")]),t._v(" "),n("p",[t._v("相关资料：")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/%E5%BD%B1%E5%AD%90_DOM",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN 影子DOM（Shadow DOM）"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Components"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://developers.google.com/web/fundamentals/web-components/shadowdom?hl=zh-cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shadow DOM v1：独立的网络组件"),n("OutboundLink")],1)])]),t._v(" "),n("h1",{attrs:{id:"thinking-in-microfrontend-微前端的那些事儿"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#thinking-in-microfrontend-微前端的那些事儿"}},[t._v("#")]),t._v(" Thinking in Microfrontend (微前端的那些事儿)")]),t._v(" "),n("p",[n("RouterLink",{attrs:{to:"/design/microserviceWeb/english.html"}},[t._v("English")])],1),t._v(" "),n("blockquote",[n("p",[t._v("微前端是一种类似于微服务的架构，它将微服务的理念应用于浏览器端，即将 Web 应用由单一的单体应用转变为"),n("strong",[t._v("多个小型前端应用聚合为一的应用")]),t._v("。各个前端应用还可以"),n("strong",[t._v("独立运行")]),t._v("、"),n("strong",[t._v("独立开发")]),t._v("、"),n("strong",[t._v("独立部署")]),t._v("。")])]),t._v(" "),n("p",[t._v("同时，它们也可以在"),n("strong",[t._v("共享组件")]),t._v("的同时进行并行开发——这些组件可以通过 NPM 或者 Git Tag、Git Submodule 来管理。")]),t._v(" "),n("p",[n("strong",[t._v("注意")]),t._v("：这里的前端应用指的是前后端分离的单页面应用，在这基础才谈论微前端才有意义。")]),t._v(" "),n("p",[t._v("支持作者（纸质版）：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(362),alt:"前端架构：从入门到微前端"}})]),t._v(" "),n("p",[t._v("支持作者：")]),t._v(" "),n("ul",[n("li",[t._v("京东：《"),n("a",{attrs:{href:"https://item.jd.com/12621088.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端架构：从入门到微前端"),n("OutboundLink")],1),t._v("》")])]),t._v(" "),n("p",[n("strong",[t._v("目录")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF"}},[t._v("微前端的那些事儿")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%AE%9E%E6%96%BD%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E5%BC%8F"}},[t._v("实施微前端的六种方式")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%9F%BA%E7%A1%80%E9%93%BA%E5%9E%AB%E5%BA%94%E7%94%A8%E5%88%86%E5%8F%91%E8%B7%AF%E7%94%B1---%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E5%BA%94%E7%94%A8"}},[t._v("基础铺垫：应用分发路由 ->\n路由分发应用")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%90%8E%E7%AB%AF%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8---%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"}},[t._v("后端：函数调用 -> 远程调用")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E8%B0%83%E7%94%A8---%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8"}},[t._v("前端：组件调用 -> 应用调用")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91%E5%BC%8F%E5%BE%AE%E5%89%8D%E7%AB%AF"}},[t._v("路由分发式微前端")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8-iframe-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"}},[t._v("使用 iFrame 创建容器")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%87%AA%E5%88%B6%E6%A1%86%E6%9E%B6%E5%85%BC%E5%AE%B9%E5%BA%94%E7%94%A8"}},[t._v("自制框架兼容应用")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%BB%84%E5%90%88%E5%BC%8F%E9%9B%86%E6%88%90%E5%B0%86%E5%BA%94%E7%94%A8%E5%BE%AE%E4%BB%B6%E5%8C%96"}},[t._v("组合式集成：将应用微件化")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%BA%AF-web-components-%E6%8A%80%E6%9C%AF%E6%9E%84%E5%BB%BA"}},[t._v("纯 Web Components 技术构建")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%BB%93%E5%90%88-web-components-%E6%9E%84%E5%BB%BA"}},[t._v("结合 Web Components 构建")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%9C%A8-web-components-%E4%B8%AD%E9%9B%86%E6%88%90%E7%8E%B0%E6%9C%89%E6%A1%86%E6%9E%B6"}},[t._v("在 Web Components\n中集成现有框架")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E9%9B%86%E6%88%90%E5%9C%A8%E7%8E%B0%E6%9C%89%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84-web-components"}},[t._v("集成在现有框架中的 Web\nComponents")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%A4%8D%E5%90%88%E5%9E%8B"}},[t._v("复合型")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%BC%80%E5%A7%8B%E5%9C%A8%E6%B5%81%E8%A1%8Cweb-%E5%BA%94%E7%94%A8%E7%9A%84%E8%81%9A%E5%90%88"}},[t._v("为什么微前端开始在流行------Web\n应用的聚合")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E9%81%97%E7%95%99%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB"}},[t._v("前端遗留系统迁移")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%90%8E%E7%AB%AF%E8%A7%A3%E8%80%A6%E5%89%8D%E7%AB%AF%E8%81%9A%E5%90%88"}},[t._v("后端解耦，前端聚合")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%85%BC%E5%AE%B9%E9%81%97%E7%95%99%E7%B3%BB%E7%BB%9F"}},[t._v("兼容遗留系统")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%A6%82%E4%BD%95%E8%A7%A3%E6%9E%84%E5%8D%95%E4%BD%93%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%8F%E6%8B%86%E5%88%86"}},[t._v("如何解构单体前端应用------前端应用的微服务式拆分")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8C%96"}},[t._v("前端微服化")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91"}},[t._v("独立开发")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%8B%AC%E7%AB%8B%E9%83%A8%E7%BD%B2"}},[t._v("独立部署")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E6%88%91%E4%BB%AC%E7%9C%9F%E7%9A%84%E9%9C%80%E8%A6%81%E6%8A%80%E6%9C%AF%E6%97%A0%E5%85%B3%E5%90%97"}},[t._v("我们真的需要技术无关吗？")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%8D%E5%BD%B1%E5%93%8D%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C"}},[t._v("不影响用户体验")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5"}},[t._v("微前端的设计理念")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E4%B8%80%E4%B8%AD%E5%BF%83%E5%8C%96%E8%B7%AF%E7%94%B1"}},[t._v("设计理念一：中心化路由")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E4%BA%8C%E6%A0%87%E8%AF%86%E5%8C%96%E5%BA%94%E7%94%A8"}},[t._v("设计理念二：标识化应用")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E4%B8%89%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[t._v("设计理念三：生命周期")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E5%9B%9B%E7%8B%AC%E7%AB%8B%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8C%96"}},[t._v("设计理念四：独立部署与配置自动化")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%AE%9E%E6%88%98%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"}},[t._v("实战微前端架构设计")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E7%8B%AC%E7%AB%8B%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8C%96"}},[t._v("独立部署与配置自动化")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BA%94%E7%94%A8%E9%97%B4%E8%B7%AF%E7%94%B1%E4%BA%8B%E4%BB%B6"}},[t._v("应用间路由------事件")])])])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%A4%A7%E5%9E%8B-angular-%E5%BA%94%E7%94%A8%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%8B%86%E5%88%86%E7%AD%96%E7%95%A5"}},[t._v("大型 Angular\n应用微前端的四种拆分策略")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD%E5%8F%8A%E5%85%B6%E5%8F%98%E4%BD%93"}},[t._v("前端微服务化：路由懒加载及其变体")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%96%B9%E6%A1%88%E5%AD%90%E5%BA%94%E7%94%A8%E6%A8%A1%E5%BC%8F"}},[t._v("微服务化方案：子应用模式")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"}},[t._v("方案对比")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E6%A0%87%E5%87%86-lazyload"}},[t._v("标准 LazyLoad")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#lazyload-%E5%8F%98%E4%BD%93-1%E6%9E%84%E5%BB%BA%E6%97%B6%E9%9B%86%E6%88%90"}},[t._v("LazyLoad 变体 1：构建时集成")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#lazyload-%E5%8F%98%E4%BD%93-2%E6%9E%84%E5%BB%BA%E5%90%8E%E9%9B%86%E6%88%90"}},[t._v("LazyLoad 变体 2：构建后集成")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96"}},[t._v("前端微服务化")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E6%80%BB%E5%AF%B9%E6%AF%94"}},[t._v("总对比")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E4%BD%BF%E7%94%A8%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6-mooa-%E5%BC%80%E5%8F%91%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8"}},[t._v("前端微服务化：使用微前端框架 Mooa\n开发微前端应用")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#mooa-%E6%A6%82%E5%BF%B5"}},[t._v("Mooa 概念")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E4%B8%BB%E5%B7%A5%E7%A8%8B%E5%88%9B%E5%BB%BA"}},[t._v("微前端主工程创建")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#mooa-%E5%AD%90%E5%BA%94%E7%94%A8%E5%88%9B%E5%BB%BA"}},[t._v("Mooa 子应用创建")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%AF%BC%E8%88%AA%E5%88%B0%E7%89%B9%E5%AE%9A%E7%9A%84%E5%AD%90%E5%BA%94%E7%94%A8"}},[t._v("导航到特定的子应用")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%89%8D%E7%AB%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E4%BD%BF%E7%94%A8%E7%89%B9%E5%88%B6%E7%9A%84-iframe-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8C%96-angular-%E5%BA%94%E7%94%A8"}},[t._v("前端微服务化：使用特制的 iframe 微服务化 Angular\n应用")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#iframe-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"}},[t._v("iframe 微服务架构设计")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6-mooa-%E7%9A%84%E7%89%B9%E5%88%B6-iframe-%E6%A8%A1%E5%BC%8F"}},[t._v("微前端框架 Mooa 的特制 iframe\n模式")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6-mooa-iframe-%E9%80%9A%E8%AE%AF%E6%9C%BA%E5%88%B6"}},[t._v("微前端框架 Mooa iframe\n通讯机制")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%8F%91%E5%B8%83%E4%B8%BB%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6"}},[t._v("发布主应用事件")])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%9B%91%E5%90%AC%E5%AD%90%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6"}},[t._v("监听子应用事件")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E7%A4%BA%E4%BE%8B"}},[t._v("示例")])])])]),t._v(" "),n("li",[n("a",{attrs:{href:"#%E8%B5%84%E6%BA%90"}},[t._v("资源")])])]),t._v(" "),n("h1",{attrs:{id:"为什么微前端开始在流行-web-应用的聚合-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么微前端开始在流行-web-应用的聚合-2"}},[t._v("#")]),t._v(" 为什么微前端开始在流行——Web 应用的聚合")]),t._v(" "),n("blockquote",[n("p",[t._v("采用新技术，更多不是因为先进，而是因为它能解决痛点。")])]),t._v(" "),n("p",[t._v("过去，我一直有一个疑惑，人们是否真的需要微服务，是否真的需要微前端。毕竟，没有银弹。当人们考虑是否采用一种新的架构，除了考虑它带来好处之外，仍然也考量着存在的大量的风险和技术挑战。")]),t._v(" "),n("h2",{attrs:{id:"前端遗留系统迁移-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端遗留系统迁移-2"}},[t._v("#")]),t._v(" 前端遗留系统迁移")]),t._v(" "),n("p",[t._v("自微前端框架 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v(" 及对应的《"),n("a",{attrs:{href:"https://github.com/phodal/microfrontend",target:"_blank",rel:"noopener noreferrer"}},[t._v("微前端的那些事儿"),n("OutboundLink")],1),t._v("》发布的两个多月以来，我陆陆续续地接收到一些微前端架构的一些咨询。过程中，我发现了一件很有趣的事："),n("strong",[t._v("解决遗留系统，才是人们采用微前端方案最重要的原因")]),t._v("。")]),t._v(" "),n("p",[t._v("这些咨询里，开发人员所遇到的情况，与我之前遇到的情形并相似，我的场景是：设计一个新的前端架构。他们开始考虑前端微服务化，是因为遗留系统的存在。")]),t._v(" "),n("p",[t._v("过去那些使用 Backbone.js、Angular.js、Vue.js 1 等等框架所编写的单页面应用，已经在线上稳定地运行着，也没有新的功能。对于这样的应用来说，我们也没有理由浪费时间和精力重写旧的应用。这里的那些使用旧的、不再使用的技术栈编写的应用，可以称为遗留系统。而，这些应用又需要结合到新应用中使用。我遇到的较多的情况是：旧的应用使用的是 Angular.js 编写，而新的应用开始采用 Angular 2+。这对于业务稳定的团队来说，是极为常见的技术栈。")]),t._v(" "),n("p",[t._v("在即不重写原有系统的基础之下，又可以抽出人力来开发新的业务。其不仅仅对于业务人员来说， 是一个相当吸引力的特性；对于技术人员来说，不重写旧的业务，同时还能做一些技术上的挑战，也是一件相当有挑战的事情。")]),t._v(" "),n("h2",{attrs:{id:"后端解耦-前端聚合-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端解耦-前端聚合-2"}},[t._v("#")]),t._v(" 后端解耦，前端聚合")]),t._v(" "),n("p",[t._v("而前端微服务的一个卖点也在这里，去兼容不同类型的前端框架。这让我又联想到微服务的好处，及许多项目落地微服务的原因：")]),t._v(" "),n("p",[t._v("在初期，后台微服务的一个很大的卖点在于，可以使用不同的技术栈来开发后台应用。但是，事实上，采用微服务架构的组织和机构，一般都是中大型规模的。相较于中小型，对于框架和语言的选型要求比较严格，如在内部限定了框架，限制了语言。因此，在充分使用不同的技术栈来发挥微服务的优势这一点上，几乎是很少出现的。在这些大型组织机构里，采用微服务的原因主要还是在于，"),n("strong",[t._v("使用微服务架构来解耦服务间依赖")]),t._v("。")]),t._v(" "),n("p",[t._v("而在前端微服务化上，则是恰恰与之相反的，人们更想要的结果是"),n("strong",[t._v("聚合")]),t._v("，尤其是那些 To B（to Bussiness）的应用。")]),t._v(" "),n("p",[t._v("在这两三年里，移动应用出现了一种趋势，用户不想装那么多应用了。而往往一家大的商业公司，会提供一系列的应用。这些应用也从某种程度上，反应了这家公司的组织架构。然而，在用户的眼里他们就是一家公司，他们就只应该有一个产品。相似的，这种趋势也在桌面 Web 出现。"),n("strong",[t._v("聚合")]),t._v("成为了一个技术趋势，体现在前端的聚合就是微服务化架构。")]),t._v(" "),n("h2",{attrs:{id:"兼容遗留系统-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#兼容遗留系统-2"}},[t._v("#")]),t._v(" 兼容遗留系统")]),t._v(" "),n("p",[t._v("那么，在这个时候，我们就需要使用新的技术、新的架构，来容纳、兼容这些旧的应用。而前端微服务化，正好是契合人们想要的这个卖点罢了。")]),t._v(" "),n("h1",{attrs:{id:"实施微前端的六种方式-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实施微前端的六种方式-2"}},[t._v("#")]),t._v(" 实施微前端的六种方式")]),t._v(" "),n("p",[t._v("微前端架构是一种类似于微服务的架构，它将微服务的理念应用于浏览器端，即将 Web 应用由单一的单体应用转变为"),n("strong",[t._v("多个小型前端应用聚合为一的应用")]),t._v("。")]),t._v(" "),n("p",[t._v("由此带来的变化是，这些前端应用可以"),n("strong",[t._v("独立运行")]),t._v("、"),n("strong",[t._v("独立开发")]),t._v("、"),n("strong",[t._v("独立部署")]),t._v("。以及，它们应该可以在"),n("strong",[t._v("共享组件")]),t._v("的同时进行并行开发——这些组件可以通过 NPM 或者 Git Tag、Git Submodule 来管理。")]),t._v(" "),n("p",[n("strong",[t._v("注意")]),t._v("：这里的前端应用指的是前后端分离的单应用页面，在这基础才谈论微前端才有意义。")]),t._v(" "),n("p",[t._v("结合我最近半年在"),n("a",{attrs:{href:"https://github.com/phodal/microfrontends",target:"_blank",rel:"noopener noreferrer"}},[t._v("微前端"),n("OutboundLink")],1),t._v("方面的实践和研究来看，微前端架构一般可以由以下几种方式进行：")]),t._v(" "),n("ol",[n("li",[t._v("使用 HTTP 服务器的路由来重定向多个应用")]),t._v(" "),n("li",[t._v("在不同的框架之上设计通讯、加载机制，诸如 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v(" 和 "),n("a",{attrs:{href:"https://github.com/CanopyTax/single-spa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Single-SPA"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("通过组合多个独立应用、组件来构建一个单体应用")]),t._v(" "),n("li",[t._v("iFrame。使用 iFrame 及自定义消息传递机制")]),t._v(" "),n("li",[t._v("使用纯 Web Components 构建应用")]),t._v(" "),n("li",[t._v("结合 Web Components 构建")])]),t._v(" "),n("h2",{attrs:{id:"基础铺垫-应用分发路由-路由分发应用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础铺垫-应用分发路由-路由分发应用-2"}},[t._v("#")]),t._v(" 基础铺垫：应用分发路由 -> 路由分发应用")]),t._v(" "),n("p",[t._v("在一个单体前端、单体后端应用中，有一个典型的特征，即路由是由"),n("strong",[t._v("框架")]),t._v("来分发的，框架将路由指定到对应的组件或者内部服务中。微服务在这个过程中做的事情是，将调用由"),n("strong",[t._v("函数调用")]),t._v("变成了"),n("strong",[t._v("远程调用")]),t._v("，诸如远程 HTTP 调用。而微前端呢，也是类似的，它是将"),n("strong",[t._v("应用内的组件调用")]),t._v("变成了更细粒度的"),n("strong",[t._v("应用间组件调用")]),t._v("，即原先我们只是将路由分发到应用的组件执行，现在则需要根据路由来找到对应的应用，再由应用分发到对应的组件上。")]),t._v(" "),n("h3",{attrs:{id:"后端-函数调用-远程调用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端-函数调用-远程调用-2"}},[t._v("#")]),t._v(" 后端：函数调用 -> 远程调用")]),t._v(" "),n("p",[t._v("在大多数的 CRUD 类型的 Web 应用中，也都存在一些极为相似的模式，即：首页 -> 列表 -> 详情：")]),t._v(" "),n("ul",[n("li",[t._v("首页，用于面向用户展示特定的数据或页面。这些数据通常是有限个数的，并且是多种模型的。")]),t._v(" "),n("li",[t._v("列表，即数据模型的聚合，其典型特点是某一类数据的集合，可以看到尽可能多的"),n("strong",[t._v("数据概要")]),t._v("（如 Google 只返回  100 页），典型见 Google、淘宝、京东的搜索结果页。")]),t._v(" "),n("li",[t._v("详情，展示一个数据的尽可能多的内容。")])]),t._v(" "),n("p",[t._v("如下是一个 Spring 框架，用于返回首页的示例：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("homePage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/WEB-INF/jsp/index.jsp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("对于某个详情页面来说，它可能是这样的：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/detail/{detailId}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("detail")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletRequest")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelMap")]),t._v(" model"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ModelAndView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/WEB-INF/jsp/detail.jsp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"detail"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("那么，在微服务的情况下，它则会变成这样子：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('@RequestMapping("/name")\npublic String name(){\n    String name = restTemplate.getForObject("http://account/name", String.class);\n    return Name" + name;\n}\n')])])]),n("p",[t._v("而后端在这个过程中，多了一个服务发现的服务，来管理不同微服务的关系。")]),t._v(" "),n("h3",{attrs:{id:"前端-组件调用-应用调用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端-组件调用-应用调用-2"}},[t._v("#")]),t._v(" 前端：组件调用 -> 应用调用")]),t._v(" "),n("p",[t._v("在形式上来说，单体前端框架的路由和单体后端应用，并没有太大的区别："),n("strong",[t._v("依据不同的路由，来返回不同页面的模板。")])]),t._v(" "),n("div",{staticClass:"language-javascritp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("const appRoutes: Routes = [\n  { path: 'index', component: IndexComponent },\n  { path: 'detail/:id', component: DetailComponent },\n];\n")])])]),n("p",[t._v("而当我们将之微服务化后，则可能变成应用 A 的路由：")]),t._v(" "),n("div",{staticClass:"language-javascritp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("const appRoutes: Routes = [\n  { path: 'index', component: IndexComponent },\n];\n")])])]),n("p",[t._v("外加之应用 B 的路由：")]),t._v(" "),n("div",{staticClass:"language-javascritp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("const appRoutes: Routes = [\n  { path: 'detail/:id', component: DetailComponent },\n];\n")])])]),n("p",[t._v("而问题的关键就在于："),n("strong",[t._v("怎么将路由分发到这些不同的应用中去")]),t._v("。与此同时，还要负责管理不同的前端应用。")]),t._v(" "),n("h2",{attrs:{id:"路由分发式微前端-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由分发式微前端-2"}},[t._v("#")]),t._v(" 路由分发式微前端")]),t._v(" "),n("p",[n("strong",[t._v("路由分发式微前端")]),t._v("，即通过路由将不同的业务"),n("strong",[t._v("分发到不同的、独立前端应用")]),t._v("上。其通常可以通过 HTTP 服务器的反向代理来实现，又或者是应用框架自带的路由来解决。")]),t._v(" "),n("p",[t._v("就当前而言，通过路由分发式的微前端架构应该是采用最多、最易采用的 “微前端” 方案。但是这种方式看上去更像是"),n("strong",[t._v("多个前端应用的聚合")]),t._v("，即我们只是将这些不同的前端应用拼凑到一起，使他们看起来像是一个完整的整体。但是它们并不是，每次用户从 A 应用到 B 应用的时候，往往需要刷新一下页面。")]),t._v(" "),n("p",[t._v("在几年前的一个项目里，我们当时正在进行"),n("strong",[t._v("遗留系统重写")]),t._v("。我们制定了一个迁移计划：")]),t._v(" "),n("ol",[n("li",[t._v("首先，使用"),n("strong",[t._v("静态网站生成")]),t._v("动态生成首页")]),t._v(" "),n("li",[t._v("其次，使用 React 计划栈重构详情页")]),t._v(" "),n("li",[t._v("最后，替换搜索结果页")])]),t._v(" "),n("p",[t._v("整个系统并不是一次性迁移过去，而是一步步往下进行。因此在完成不同的步骤时，我们就需要上线这个功能，于是就需要使用 Nginx 来进行路由分发。")]),t._v(" "),n("p",[t._v("如下是一个基于路由分发的 Nginx 配置示例：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("http {\n  server {\n    listen       80;\n    server_name  www.phodal.com;\n    location /api/ {\n      proxy_pass http://http://172.31.25.15:8000/api;\n    }\n    location /web/admin {\n      proxy_pass http://172.31.25.29/web/admin;\n    }\n    location /web/notifications {\n      proxy_pass http://172.31.25.27/web/notifications;\n    }\n    location / {\n      proxy_pass /;\n    }\n  }\n}\n")])])]),n("p",[t._v("在这个示例里，不同的页面的请求被分发到不同的服务器上。")]),t._v(" "),n("p",[t._v("随后，我们在别的项目上也使用了类似的方式，其主要原因是："),n("strong",[t._v("跨团队的协作")]),t._v("。当团队达到一定规模的时候，我们不得不面对这个问题。除此，还有 Angluar 跳崖式升级的问题。于是，在这种情况下，用户前台使用 Angular 重写，后台继续使用 Angular.js 等保持再有的技术栈。在不同的场景下，都有一些相似的技术决策。")]),t._v(" "),n("p",[t._v("因此在这种情况下，它适用于以下场景：")]),t._v(" "),n("ul",[n("li",[t._v("不同技术栈之间差异比较大，难以兼容、迁移、改造")]),t._v(" "),n("li",[t._v("项目不想花费大量的时间在这个系统的改造上")]),t._v(" "),n("li",[t._v("现有的系统在未来将会被取代")]),t._v(" "),n("li",[t._v("系统功能已经很完善，基本不会有新需求")])]),t._v(" "),n("p",[t._v("而在满足上面场景的情况下，如果为了更好的用户体验，还可以采用 iframe 的方式来解决。")]),t._v(" "),n("h2",{attrs:{id:"使用-iframe-创建容器-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-iframe-创建容器-2"}},[t._v("#")]),t._v(" 使用 iFrame 创建容器")]),t._v(" "),n("p",[t._v("iFrame 作为一个非常古老的，人人都觉得普通的技术，却一直很管用。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("HTML 内联框架元素")]),t._v(" "),n("code",[t._v("<iframe>")]),t._v(" 表示嵌套的正在浏览的上下文，能有效地将另一个 HTML 页面嵌入到当前页面中。")])]),t._v(" "),n("p",[t._v("iframe 可以创建一个全新的独立的宿主环境，这意味着我们的前端应用之间可以相互独立运行。采用 iframe 有几个重要的前提：")]),t._v(" "),n("ul",[n("li",[t._v("网站不需要 SEO 支持")]),t._v(" "),n("li",[t._v("拥有相应的"),n("strong",[t._v("应用管理机制")]),t._v("。")])]),t._v(" "),n("p",[t._v("如果我们做的是一个应用平台，会在我们的系统中集成第三方系统，或者多个不同部门团队下的系统，显然这是一个不错的方案。一些典型的场景，如传统的 Desktop 应用迁移到 Web 应用：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(331),alt:"Angular Tabs 示例"}})]),t._v(" "),n("p",[t._v("如果这一类应用过于复杂，那么它必然是要进行微服务化的拆分。因此，在采用 iframe 的时候，我们需要做这么两件事：")]),t._v(" "),n("ul",[n("li",[t._v("设计"),n("strong",[t._v("管理应用机制")])]),t._v(" "),n("li",[t._v("设计"),n("strong",[t._v("应用通讯机制")])])]),t._v(" "),n("p",[n("strong",[t._v("加载机制")]),t._v("。在什么情况下，我们会去加载、卸载这些应用；在这个过程中，采用怎样的动画过渡，让用户看起来更加自然。")]),t._v(" "),n("p",[n("strong",[t._v("通讯机制")]),t._v("。直接在每个应用中创建 "),n("code",[t._v("postMessage")]),t._v(" 事件并监听，并不是一个友好的事情。其本身对于应用的侵入性太强，因此通过 "),n("code",[t._v("iframeEl.contentWindow")]),t._v(" 去获取 iFrame 元素的 Window 对象是一个更简化的做法。随后，就需要"),n("strong",[t._v("定义一套通讯规范")]),t._v("：事件名采用什么格式、什么时候开始监听事件等等。")]),t._v(" "),n("p",[t._v("有兴趣的读者，可以看看笔者之前写的微前端框架："),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v("不管怎样，iframe 对于我们今年的 KPI 怕是带不来一丝的好处，那么我们就去造个轮子吧。")]),t._v(" "),n("h2",{attrs:{id:"自制框架兼容应用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自制框架兼容应用-2"}},[t._v("#")]),t._v(" 自制框架兼容应用")]),t._v(" "),n("p",[t._v("不论是基于 Web Components 的 Angular，或者是 VirtualDOM 的 React 等，现有的前端框架都离不开基本的 HTML 元素 DOM。")]),t._v(" "),n("p",[t._v("那么，我们只需要：")]),t._v(" "),n("ol",[n("li",[t._v("在页面合适的地方引入或者创建 DOM")]),t._v(" "),n("li",[t._v("用户操作时，加载对应的应用（触发应用的启动），并能卸载应用。")])]),t._v(" "),n("p",[t._v("第一个问题，创建 DOM 是一个容易解决的问题。而第二个问题，则一点儿不容易，特别是移除 DOM 和相应应用的监听。当我们拥有一个不同的技术栈时，我们就需要有针对性设计出一套这样的逻辑。")]),t._v(" "),n("p",[t._v("尽管 "),n("a",{attrs:{href:"https://github.com/CanopyTax/single-spa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Single-SPA"),n("OutboundLink")],1),t._v(" 已经拥有了大部分框架（如 React、Angular、Vue 等框架）的启动和卸载处理，但是它仍然不是适合于生产用途。当我基于 Single-SPA 为 Angular 框架设计一个微前端架构的应用时，我最后选择重写一个自己的框架，即 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v("虽然，这种方式的上手难度相对比较高，但是后期订制及可维护性比较方便。在不考虑每次加载应用带来的用户体验问题，其唯一存在的风险可能是："),n("strong",[t._v("第三方库不兼容")]),t._v("。")]),t._v(" "),n("p",[t._v("但是，不论怎样，与 iFrame 相比，其在技术上更具有"),n("strong",[t._v("可吹牛逼性")]),t._v("，更有看点。同样的，与 iframe 类似，我们仍然面对着一系列的不大不小的问题：")]),t._v(" "),n("ul",[n("li",[t._v("需要设计一套管理应用的机制。")]),t._v(" "),n("li",[t._v("对于流量大的 toC 应用来说，会在首次加载的时候，会多出大量的请求")])]),t._v(" "),n("p",[t._v("而我们即又要拆分应用，又想 blabla……，我们还能怎么做？")]),t._v(" "),n("h2",{attrs:{id:"组合式集成-将应用微件化-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#组合式集成-将应用微件化-2"}},[t._v("#")]),t._v(" 组合式集成：将应用微件化")]),t._v(" "),n("p",[n("strong",[t._v("组合式集成")]),t._v("，即通过"),n("strong",[t._v("软件工程")]),t._v("的方式在构建前、构建时、构建后等步骤中，对应用进行一步的拆分，并重新组合。")]),t._v(" "),n("p",[t._v("从这种定义上来看，它可能算不上并不是一种微前端——它可以满足了微前端的三个要素，即："),n("strong",[t._v("独立运行")]),t._v("、"),n("strong",[t._v("独立开发")]),t._v("、"),n("strong",[t._v("独立部署")]),t._v("。但是，配合上前端框架的组件 Lazyload 功能——即在需要的时候，才加载对应的业务组件或应用，它看上去就是一个微前端应用。")]),t._v(" "),n("p",[t._v("与此同时，由于所有的依赖、Pollyfill 已经尽可能地在首次加载了，CSS 样式也不需要重复加载。")]),t._v(" "),n("p",[t._v("常见的方式有：")]),t._v(" "),n("ul",[n("li",[t._v("独立构建组件和应用，生成 chunk 文件，构建后再"),n("strong",[t._v("归类")]),t._v("生成的 chunk 文件。（这种方式更类似于微服务，但是成本更高）")]),t._v(" "),n("li",[t._v("开发时独立开发组件或应用，集成时合并组件和应用，最后生成单体的应用。")]),t._v(" "),n("li",[t._v("在运行时，加载应用的 Runtime，随后加载对应的应用代码和模板。")])]),t._v(" "),n("p",[t._v("应用间的关系如下图所示（其忽略图中的 “前端微服务化”）：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(306),alt:"组合式集成对比"}})]),t._v(" "),n("p",[t._v("这种方式看上去相当的理想，即能满足多个团队并行开发，又能构建出适合的交付物。")]),t._v(" "),n("p",[t._v("但是，首先它有一个严重的限制："),n("strong",[t._v("必须使用同一个框架")]),t._v("。对于多数团队来说，这并不是问题。采用微服务的团队里，也不会因为微服务这一个前端，来使用不同的语言和技术来开发。当然了，如果要使用别的框架，也不是问题，我们只需要结合上一步中的"),n("strong",[t._v("自制框架兼容应用")]),t._v("就可以满足我们的需求。")]),t._v(" "),n("p",[t._v("其次，采用这种方式还有一个限制，那就是："),n("strong",[t._v("规范！****规范！****规范！")]),t._v("。在采用这种方案时，我们需要：")]),t._v(" "),n("ul",[n("li",[t._v("统一依赖。统一这些依赖的版本，引入新的依赖时都需要一一加入。")]),t._v(" "),n("li",[t._v("规范应用的组件及路由。避免不同的应用之间，因为这些组件名称发生冲突。")]),t._v(" "),n("li",[t._v("构建复杂。在有些方案里，我们需要修改构建系统，有些方案里则需要复杂的架构脚本。")]),t._v(" "),n("li",[t._v("共享通用代码。这显然是一个要经常面对的问题。")]),t._v(" "),n("li",[t._v("制定代码规范。")])]),t._v(" "),n("p",[t._v("因此，这种方式看起来更像是一个软件工程问题。")]),t._v(" "),n("p",[t._v("现在，我们已经有了四种方案，每个方案都有自己的利弊。显然，结合起来会是一种更理想的做法。")]),t._v(" "),n("p",[t._v("考虑到现有及常用的技术的局限性问题，让我们再次将目光放得长远一些。")]),t._v(" "),n("h2",{attrs:{id:"纯-web-components-技术构建-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#纯-web-components-技术构建-2"}},[t._v("#")]),t._v(" 纯 Web Components 技术构建")]),t._v(" "),n("p",[t._v("在学习 Web Components 开发微前端架构的过程中，我尝试去写了我自己的 Web Components 框架："),n("a",{attrs:{href:"https://github.com/phodal/oan",target:"_blank",rel:"noopener noreferrer"}},[t._v("oan"),n("OutboundLink")],1),t._v("。在添加了一些基本的 Web 前端框架的功能之后，我发现这项技术特别适合于"),n("strong",[t._v("作为微前端的基石")]),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("Web Components 是一套不同的技术，允许您创建可重用的定制元素（它们的功能封装在您的代码之外）并且在您的 Web 应用中使用它们。")])]),t._v(" "),n("p",[t._v("它主要由四项技术组件：")]),t._v(" "),n("ul",[n("li",[t._v("Custom elements，允许开发者创建自定义的元素，诸如 "),n("today-news"),t._v("。")],1),t._v(" "),n("li",[t._v("Shadow DOM，即影子 DOM，通常是将 Shadow DOM 附加到主文档 DOM 中，并可以控制其关联的功能。而这个 Shadow DOM 则是不能直接用其它主文档 DOM 来控制的。")]),t._v(" "),n("li",[t._v("HTML templates，即 "),n("code",[t._v("<template>")]),t._v(" 和 "),n("code",[t._v("<slot>")]),t._v(" 元素，用于编写不在页面中显示的标记模板。")]),t._v(" "),n("li",[t._v("HTML Imports，用于引入自定义组件。")])]),t._v(" "),n("p",[t._v("每个组件由 "),n("code",[t._v("link")]),t._v(" 标签引入：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<link rel="import" href="components/di-li.html">\n<link rel="import" href="components/d-header.html">\n')])])]),n("p",[t._v("随后，在各自的 HTML 文件里，创建相应的组件元素，编写相应的组件逻辑。一个典型的 Web Components 应用架构如下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(332),alt:"Web Components 架构"}})]),t._v(" "),n("p",[t._v("可以看到这边方式与我们上面使用 iframe 的方式很相似，组件拥有自己独立的 "),n("code",[t._v("Scripts")]),t._v(" 和 "),n("code",[t._v("Styles")]),t._v("，以及对应的用于单独部署组件的域名。然而它并没有想象中的那么美好，要直接使用"),n("strong",[t._v("纯")]),t._v(" Web Components 来构建前端应用的难度有：")]),t._v(" "),n("ul",[n("li",[t._v("重写现有的前端应用。是的，现在我们需要完成使用 Web Components 来完成整个系统的功能。")]),t._v(" "),n("li",[t._v("上下游生态系统不完善。缺乏相应的一些第三方控件支持，这也是为什么 jQuery 相当流行的原因。")]),t._v(" "),n("li",[t._v("系统架构复杂。当应用被拆分为一个又一个的组件时，组件间的通讯就成了一个特别大的麻烦。")])]),t._v(" "),n("p",[t._v("Web Components 中的 ShadowDOM 更像是新一代的前端 DOM 容器。而遗憾的是并不是所有的浏览器，都可以完全支持 Web Components。")]),t._v(" "),n("h2",{attrs:{id:"结合-web-components-构建-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结合-web-components-构建-2"}},[t._v("#")]),t._v(" 结合 Web Components 构建")]),t._v(" "),n("p",[t._v("Web Components 离现在的我们太远，可是结合 Web Components 来构建前端应用，则更是一种面向未来演进的架构。或者说在未来的时候，我们可以开始采用这种方式来构建我们的应用。好在，已经有框架在打造这种可能性。")]),t._v(" "),n("p",[t._v("就当前而言，有两种方式可以结合 Web Components 来构建微前端应用：")]),t._v(" "),n("ul",[n("li",[t._v("使用 Web Components 构建独立于框架的组件，随后在对应的框架中引入这些组件")]),t._v(" "),n("li",[t._v("在 Web Components 中引入现有的框架，类似于 iframe 的形式")])]),t._v(" "),n("p",[t._v("前者是一种组件式的方式，或者则像是在迁移未来的 “遗留系统” 到未来的架构上。")]),t._v(" "),n("h3",{attrs:{id:"在-web-components-中集成现有框架-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在-web-components-中集成现有框架-2"}},[t._v("#")]),t._v(" 在 Web Components 中集成现有框架")]),t._v(" "),n("p",[t._v("现有的 Web 框架已经有一些可以支持 Web Components 的形式，诸如 Angular 支持的 createCustomElement，就可以实现一个 Web Components 形式的组件：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("platformBrowser()\n  .bootstrapModuleFactory(MyPopupModuleNgFactory)\n    .then(({injector}) => {\n      const MyPopupElement = createCustomElement(MyPopup, {injector});\n      customElements.define(‘my-popup’, MyPopupElement);\n});\n")])])]),n("p",[t._v("在未来，将有更多的框架可以使用类似这样的形式，集成到 Web Components 应用中。")]),t._v(" "),n("h3",{attrs:{id:"集成在现有框架中的-web-components-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集成在现有框架中的-web-components-2"}},[t._v("#")]),t._v(" 集成在现有框架中的 Web Components")]),t._v(" "),n("p",[t._v("另外一种方式，则是类似于 "),n("a",{attrs:{href:"https://github.com/ionic-team/stencil",target:"_blank",rel:"noopener noreferrer"}},[t._v("Stencil"),n("OutboundLink")],1),t._v(" 的形式，将组件直接构建成 Web Components 形式的组件，随后在对应的诸如，如 React 或者 Angular 中直接引用。")]),t._v(" "),n("p",[t._v("如下是一个在 React 中引用 Stencil 生成的 Web Components 的例子：")]),t._v(" "),n("div",{staticClass:"language-javascriptA extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport registerServiceWorker from './registerServiceWorker';\n\nimport 'test-components/testcomponents';\n\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n")])])]),n("p",[t._v("在这种情况之下，我们就可以构建出独立于框架的组件。")]),t._v(" "),n("p",[t._v("同样的 Stencil 仍然也只是支持最近的一些浏览器，比如：Chrome、Safari、Firefox、Edge 和 IE11")]),t._v(" "),n("h2",{attrs:{id:"复合型-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复合型-2"}},[t._v("#")]),t._v(" 复合型")]),t._v(" "),n("p",[n("strong",[t._v("复合型")]),t._v("，对就是上面的几个类别中，随便挑几种组合到一起。")]),t._v(" "),n("p",[t._v("我就不废话了~~。")]),t._v(" "),n("h1",{attrs:{id:"微前端架构选型指南-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端架构选型指南-2"}},[t._v("#")]),t._v(" 微前端架构选型指南")]),t._v(" "),n("p",[t._v("在上一节《实施前端微服务化的六七种方式》中，介绍了在实施微前端的过程中，我们采用的一些不同方案的架构方案。在这篇文章中，我将总结如何依据不同的情况来选择合适的方案。")]),t._v(" "),n("h2",{attrs:{id:"快速选型指南图-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快速选型指南图-2"}},[t._v("#")]),t._v(" 快速选型指南图")]),t._v(" "),n("p",[t._v("我还是直接先给结论：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(307),alt:"微前端选型指南"}})]),t._v(" "),n("p",[t._v("关键点的相关解释如下：")]),t._v(" "),n("p",[n("strong",[t._v("框架限制")]),t._v("。在后台微服务系统里，人们使用其它语言的库来开发新的服务，如用于人工智能的 Python。但是在前端，几乎不存在这种可能性。所以当我们的前端框架只有一个时，我们在采用微前端的技术时，可选范围就更大了。而遗憾的是，多数组织需要兼容遗留系统。")]),t._v(" "),n("p",[n("strong",[t._v("IE 问题")]),t._v("。不论是在几年前，还是在今年，我们实施微前端最先考虑的就是对于 IE 的支持。在我遇到的项目上，基本上都需要支持 IE，因此在技术选型上就受限一定的限制。而在我们那些不需要支持 IE 的项目上，他们就可以使用 WebComponents 技术来构建微前端应用。")]),t._v(" "),n("p",[n("strong",[t._v("依赖独立")]),t._v("。即各个微前端应用的依赖是要统一管理，还是要在各个应该中自己管理。统一管理可以解决重复加载依赖的问题，独立管理会带来额外的流量开销和等待时间。")]),t._v(" "),n("h2",{attrs:{id:"微前端方案的对比-简要对比-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端方案的对比-简要对比-2"}},[t._v("#")]),t._v(" 微前端方案的对比：简要对比")]),t._v(" "),n("p",[t._v("如果你对上述的几个方面，仍然不是很熟悉的话，请阅读《实施前端微服务化的六七种方式》。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方式")]),t._v(" "),n("th",[t._v("开发成本")]),t._v(" "),n("th",[t._v("维护成本")]),t._v(" "),n("th",[t._v("可行性")]),t._v(" "),n("th",[t._v("同一框架要求")]),t._v(" "),n("th",[t._v("实现难度")]),t._v(" "),n("th",[t._v("潜在风险")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("路由分发")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★")]),t._v(" "),n("td",[t._v("这个方案太普通了")])]),t._v(" "),n("tr",[n("td",[t._v("iFrame")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★")]),t._v(" "),n("td",[t._v("这个方案太普通了")])]),t._v(" "),n("tr",[n("td",[t._v("应用微服务化")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★★★★")]),t._v(" "),n("td",[t._v("针对每个框架做定制及 Hook")])]),t._v(" "),n("tr",[n("td",[t._v("微件化")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("是")]),t._v(" "),n("td",[t._v("★★★★★")]),t._v(" "),n("td",[t._v("针对构建系统，如 webpack 进行 hack")])]),t._v(" "),n("tr",[n("td",[t._v("微应用化")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("中")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("是")]),t._v(" "),n("td",[t._v("★★★")]),t._v(" "),n("td",[t._v("统一不同应用的构建规范")])]),t._v(" "),n("tr",[n("td",[t._v("纯 Web Components")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★★")]),t._v(" "),n("td",[t._v("新技术，浏览器的兼容问题")])]),t._v(" "),n("tr",[n("td",[t._v("结合 Web Components")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("高")]),t._v(" "),n("td",[t._v("否")]),t._v(" "),n("td",[t._v("★★")]),t._v(" "),n("td",[t._v("新技术，浏览器的兼容问题")])])])]),t._v(" "),n("p",[t._v("同样的，一些复杂概念的解释如下：")]),t._v(" "),n("p",[n("strong",[t._v("应用微服务化")]),t._v("，即每个前端应用一个独立的服务化前端应用，并配套一套统一的应用管理和启动机制，诸如微前端框架 Single-SPA 或者 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("mooa"),n("OutboundLink")],1),t._v(" 。")]),t._v(" "),n("p",[n("strong",[t._v("微件化")]),t._v("，即通过对构建系统的 hack，使不同的前端应用可以使用同一套依赖。它在"),n("strong",[t._v("应用微服务化")]),t._v("的基本上，改进了重复加载依赖文件的问题。")]),t._v(" "),n("p",[n("strong",[t._v("微应用化")]),t._v("，又可以称之为"),n("strong",[t._v("组合式集成")]),t._v("，即通过软件工程的方式，在开发环境对单体应用进行拆分，在构建环境将应用组合在一起构建成一个应用。详细的细节，可以期待后面的文章《一个单体前端应用的拆解与微服务化》")]),t._v(" "),n("h2",{attrs:{id:"微前端方案的对比-复杂方式-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端方案的对比-复杂方式-2"}},[t._v("#")]),t._v(" 微前端方案的对比：复杂方式")]),t._v(" "),n("p",[t._v("之前看到一篇微服务相关的 "),n("a",{attrs:{href:"https://www.softwarearchitekt.at/post/2017/12/28/a-software-architect-s-approach-towards-using-angular-and-spas-in-general-for-microservices-aka-microfrontends.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("文章"),n("OutboundLink")],1),t._v("，介绍了不同微服务的区别，其采用了一种比较有意思的对比方式特别详细，这里就使用同样的方式来展示：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("架构目标")]),t._v(" "),n("th",[t._v("描述")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("a. 独立开发")]),t._v(" "),n("td",[t._v("独立开发，而不受影响")])]),t._v(" "),n("tr",[n("td",[t._v("b. 独立部署")]),t._v(" "),n("td",[t._v("能作为一个服务来单独部署")])]),t._v(" "),n("tr",[n("td",[t._v("c. 支持不同框架")]),t._v(" "),n("td",[t._v("可以同时使用不同的框架，如 Angular、Vue、React")])]),t._v(" "),n("tr",[n("td",[t._v("d. 摇树优化")]),t._v(" "),n("td",[t._v("能消除未使用的代码")])]),t._v(" "),n("tr",[n("td",[t._v("e. 环境隔离")]),t._v(" "),n("td",[t._v("应用间的上下文不受干扰")])]),t._v(" "),n("tr",[n("td",[t._v("f. 多个应用同时运行")]),t._v(" "),n("td",[t._v("不同应用可以同时运行")])]),t._v(" "),n("tr",[n("td",[t._v("g. 共用依赖")]),t._v(" "),n("td",[t._v("不同应用是否共用底层依赖库")])]),t._v(" "),n("tr",[n("td",[t._v("h. 依赖冲突")]),t._v(" "),n("td",[t._v("依赖的不同版本是否导致冲突")])]),t._v(" "),n("tr",[n("td",[t._v("i. 集成编译")]),t._v(" "),n("td",[t._v("应用最后被编译成一个整体，而不是分开构建")])])])]),t._v(" "),n("p",[t._v("那么，对于下表而言，表中的 a~j 分别表示上面的几种不同的架构考虑因素。")]),t._v(" "),n("p",[t._v("（PS：考虑到  Web Components 几个单词的长度，暂时将它简称为 WC~~)")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方式")]),t._v(" "),n("th",[t._v("a")]),t._v(" "),n("th",[t._v("b")]),t._v(" "),n("th",[t._v("c")]),t._v(" "),n("th",[t._v("d")]),t._v(" "),n("th",[t._v("e")]),t._v(" "),n("th",[t._v("f")]),t._v(" "),n("th",[t._v("g")]),t._v(" "),n("th",[t._v("h")]),t._v(" "),n("th",[t._v("i")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("路由分发")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("iFrame")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("应用微服务化")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("微件化")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("微应用化")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")])]),t._v(" "),n("tr",[n("td",[t._v("纯 WC")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("-")]),t._v(" "),n("td",[t._v("O")])]),t._v(" "),n("tr",[n("td",[t._v("结合 WC")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td",[t._v("O")]),t._v(" "),n("td"),t._v(" "),n("td"),t._v(" "),n("td",[t._v("O")])])])]),t._v(" "),n("p",[t._v("图中的 O 表示支持，空白表示不支持，- 表示不受影响。")]),t._v(" "),n("p",[t._v("再结合之前的选型指南：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(307),alt:"微前端选型指南"}})]),t._v(" "),n("p",[t._v("（PS：本图采用 Keynote 绘制）")]),t._v(" "),n("p",[t._v("你是否找到你想到的架构了？")]),t._v(" "),n("h1",{attrs:{id:"如何解构单体前端应用-前端应用的微服务式拆分-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何解构单体前端应用-前端应用的微服务式拆分-2"}},[t._v("#")]),t._v(" 如何解构单体前端应用——前端应用的微服务式拆分")]),t._v(" "),n("blockquote",[n("p",[t._v("刷新页面？路由拆分？No，动态加载组件。")])]),t._v(" "),n("p",[t._v("本文分为以下四部分：")]),t._v(" "),n("ul",[n("li",[t._v("前端微服务化思想介绍")]),t._v(" "),n("li",[t._v("微前端的设计理念")]),t._v(" "),n("li",[t._v("实战微前端架构设计")]),t._v(" "),n("li",[t._v("基于 Mooa 进行前端微服务化")])]),t._v(" "),n("h2",{attrs:{id:"前端微服化-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服化-2"}},[t._v("#")]),t._v(" 前端微服化")]),t._v(" "),n("p",[t._v("对于前端微服化来说，有这么一些方案：")]),t._v(" "),n("ul",[n("li",[t._v("Web Component 显然可以一个很优秀的基础架构。然而，我们并不可能去大量地复写已有的应用。")]),t._v(" "),n("li",[t._v("iFrame。你是说真的吗？")]),t._v(" "),n("li",[t._v("另外一个微前端框架 Single-SPA，显然是一个更好的方式。然而，它并非 Production Ready。")]),t._v(" "),n("li",[t._v("通过路由来切分应用，而这个跳转会影响用户体验。")]),t._v(" "),n("li",[t._v("等等。")])]),t._v(" "),n("p",[t._v("因此，当我们考虑前端微服务化的时候，我们希望：")]),t._v(" "),n("ul",[n("li",[t._v("独立部署")]),t._v(" "),n("li",[t._v("独立开发")]),t._v(" "),n("li",[t._v("技术无关")]),t._v(" "),n("li",[t._v("不影响用户体验")])]),t._v(" "),n("h3",{attrs:{id:"独立开发-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立开发-2"}},[t._v("#")]),t._v(" 独立开发")]),t._v(" "),n("p",[t._v("在过去的几星期里，我花费了大量的时间在学习 Single-SPA 的代码。但是，我发现它在开发和部署上真的太麻烦了，完全达不到独立部署地标准。按 Single-SPA 的设计，我需要在入口文件中声名我的应用，然后才能去构建：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("declareChildApplication('inferno', () => import('src/inferno/inferno.app.js'), pathPrefix('/inferno'));\n")])])]),n("p",[t._v("同时，在我的应用里，我还需要去指定我的生命周期。这就意味着，当我开发了一个新的应用时，必须更新两份代码：主工程和应用。这时我们还极可能在同一个源码里工作。")]),t._v(" "),n("p",[t._v("当出现多个团队的时候，在同一份源码里工作，显然变得相当的不可靠——比如说，对方团队使用的是 Tab，而我们使用的是 2 个空格，隔壁的老王用的是 4 个空格。")]),t._v(" "),n("h3",{attrs:{id:"独立部署-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立部署-2"}},[t._v("#")]),t._v(" 独立部署")]),t._v(" "),n("p",[t._v("一个单体的前端应用最大的问题是，构建出来的 js、css 文件相当的巨大。而微前端则意味着，这个文件被独立地拆分成多个文件，它们便可以独立去部署应用。")]),t._v(" "),n("h3",{attrs:{id:"我们真的需要技术无关吗-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我们真的需要技术无关吗-2"}},[t._v("#")]),t._v(" 我们真的需要技术无关吗？")]),t._v(" "),n("p",[t._v("等等，我们是否真的需要"),n("strong",[t._v("技术无关")]),t._v("？如果我们不需要技术无关的话，微前端问题就很容易解决了。")]),t._v(" "),n("p",[t._v("事实上，对于大部分的公司和团队来说，技术无关只是一个无关痛痒的话术。当一家公司的几个创始人使用了 Java，那么极有可能在未来的选型上继续使用 Java。除非，一些额外的服务来使用 Python 来实现人工智能。因此，在大部分的情况下，仍然是技术栈唯一。")]),t._v(" "),n("p",[t._v("对于前端项目来说，更是如此：一个部门里基本上只会选用一个框架。")]),t._v(" "),n("p",[t._v("于是，我们选择了 Angular。")]),t._v(" "),n("h3",{attrs:{id:"不影响用户体验-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不影响用户体验-2"}},[t._v("#")]),t._v(" 不影响用户体验")]),t._v(" "),n("p",[t._v("使用路由跳转来进行前端微服务化，是一种很简单、高效的切分方式。然而，路由跳转地过程中，会有一个白屏的过程。在这个过程中，跳转前的应用和将要跳转的应用，都失去了对页面的控制权。如果这个应用出了问题，那么用户就会一脸懵逼。")]),t._v(" "),n("p",[t._v("理想的情况下，它应该可以被控制。")]),t._v(" "),n("h2",{attrs:{id:"微前端的设计理念-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端的设计理念-2"}},[t._v("#")]),t._v(" 微前端的设计理念")]),t._v(" "),n("h3",{attrs:{id:"设计理念一-中心化路由-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念一-中心化路由-2"}},[t._v("#")]),t._v(" 设计理念一：中心化路由")]),t._v(" "),n("p",[t._v("互联网本质是去中心化的吗？不，DNS 决定了它不是。TAB，决定了它不是。")]),t._v(" "),n("p",[t._v("微服务从本质上来说，它应该是去中心化的。但是，它又不能是完全的去中心化。对于一个微服务来说，它需要一个"),n("strong",[t._v("服务注册中心")]),t._v("：")]),t._v(" "),n("blockquote",[n("p",[t._v("服务提供方要注册通告服务地址，服务的调用方要能发现目标服务。")])]),t._v(" "),n("p",[t._v("对于一个前端应用来说，这个东西就是路由。")]),t._v(" "),n("p",[t._v("从页面上来说，只有我们在网页上添加一个菜单链接，用户才能知道某个页面是可以使用的。")]),t._v(" "),n("p",[t._v("而从代码上来说，那就是我们需要有一个地方来管理我们的应用：**发现存在哪些应用，哪个应用使用哪个路由。")]),t._v(" "),n("p",[n("strong",[t._v("管理好我们的路由，实际上就是管理好我们的应用")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"设计理念二-标识化应用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念二-标识化应用-2"}},[t._v("#")]),t._v(" 设计理念二：标识化应用")]),t._v(" "),n("p",[t._v("在设计一个微前端框架的时候，为"),n("strong",[t._v("每个项目取一个名字的")]),t._v("问题纠结了我很久——怎么去规范化这个东西。直到，我再一次想到了康威定律：")]),t._v(" "),n("blockquote",[n("p",[t._v("系统设计(产品结构等同组织形式，每个设计系统的组织，其产生的设计等同于组织之间的沟通结构。")])]),t._v(" "),n("p",[t._v("换句人话说，就是同一个组织下，不可能有两个项目的名称是一样的。")]),t._v(" "),n("p",[t._v("所以，这个问题很简单就解决了。")]),t._v(" "),n("h3",{attrs:{id:"设计理念三-生命周期-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念三-生命周期-2"}},[t._v("#")]),t._v(" 设计理念三：生命周期")]),t._v(" "),n("p",[t._v("Single-SPA 设计了一个基本的生命周期（虽然它没有统一管理），它包含了五种状态：")]),t._v(" "),n("ul",[n("li",[t._v("load，决定加载哪个应用，并绑定生命周期")]),t._v(" "),n("li",[t._v("bootstrap，获取静态资源")]),t._v(" "),n("li",[t._v("mount，安装应用，如创建 DOM 节点")]),t._v(" "),n("li",[t._v("unload，删除应用的生命周期")]),t._v(" "),n("li",[t._v("unmount，卸载应用，如删除 DOM 节点")])]),t._v(" "),n("p",[t._v("于是，我在设计上基本上沿用了这个生命周期。显然，诸如 load 之类对于我的设计是多余的。")]),t._v(" "),n("h3",{attrs:{id:"设计理念四-独立部署与配置自动化-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计理念四-独立部署与配置自动化-2"}},[t._v("#")]),t._v(" 设计理念四：独立部署与配置自动化")]),t._v(" "),n("p",[t._v("从某种意义上来说，整个每系统是围绕着应用配置进行的。如果应用的配置能自动化，那么整个系统就自动化。")]),t._v(" "),n("p",[t._v("当我们只开发一个新的组件，那么我们只需要更新我们的组件，并更新配置即可。而这个配置本身也应该是能自动生成的。")]),t._v(" "),n("h2",{attrs:{id:"实战微前端架构设计-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实战微前端架构设计-2"}},[t._v("#")]),t._v(" 实战微前端架构设计")]),t._v(" "),n("p",[t._v("基于以上的前提，系统的工作流程如下所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(308),alt:"系统工作流"}})]),t._v(" "),n("p",[t._v("整体的工程流程如下所示：")]),t._v(" "),n("ol",[n("li",[t._v("主工程在运行的时候，会去服务器获取最新的应用配置。")]),t._v(" "),n("li",[t._v("主工程在获取到配置后，将一一创建应用，并为应用绑定生命周期。")]),t._v(" "),n("li",[t._v("当主工程监测到路由变化的时候，将寻找是否有对应的路由匹配到应用。")]),t._v(" "),n("li",[t._v("当匹配对对应应用时，则加载相应的应用。")])]),t._v(" "),n("p",[t._v("故而，其对应的结构下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(309),alt:"Architecture"}})]),t._v(" "),n("p",[t._v("整体的流程如下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(333),alt:"Workflow"}})]),t._v(" "),n("h3",{attrs:{id:"独立部署与配置自动化-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立部署与配置自动化-2"}},[t._v("#")]),t._v(" 独立部署与配置自动化")]),t._v(" "),n("p",[t._v("我们做的部署策略如下：我们的应用使用的配置文件叫 "),n("code",[t._v("apps.json")]),t._v("，由主工程去获取这个配置。每次部署的时候，我们只需要将 "),n("code",[t._v("apps.json")]),t._v(" 指向最新的配置文件即可。配置的文件类如下所示：")]),t._v(" "),n("ol",[n("li",[t._v("96a7907e5488b6bb.json")]),t._v(" "),n("li",[t._v("6ff3bfaaa2cd39ea.json")]),t._v(" "),n("li",[t._v("dcd074685c97ab9b.json")])]),t._v(" "),n("p",[t._v("一个应用的配置如下所示：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selector"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help-root"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baseScriptUrl"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/assets/help"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"styles"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"styles.bundle.css"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prefix"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scripts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"inline.bundle.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"polyfills.bundle.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main.bundle.js"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这里的 "),n("code",[t._v("selector")]),t._v(" 对应于应用所需要的 DOM 节点，prefix 则是用于 URL 路由上。这些都是自动从 "),n("code",[t._v("index.html")]),t._v(" 文件和 "),n("code",[t._v("package.json")]),t._v(" 中获取生成的。")]),t._v(" "),n("h3",{attrs:{id:"应用间路由-事件-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用间路由-事件-2"}},[t._v("#")]),t._v(" 应用间路由——事件")]),t._v(" "),n("p",[t._v("由于现在的应用变成了两部分：主工程和应用部分。就会出现一个问题："),n("strong",[t._v("只有一个工程能捕获路由变化")]),t._v("。当由主工程去改变应用的二级路由时，就无法有效地传达到子应用。在这时，只能通过事件的方式去通知子应用，子应用也需要监测是否是当前应用的路由。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" appName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" urlPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("urlPrefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    urlPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("option"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urlPrefix"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("navigate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detail"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("urlPrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" appName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("相似的，当我们需要从应用 A 跳转到应用 B 时，我们也需要这样的一个机制：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("window.addEventListener('mooa.routing.navigate', function(event: CustomEvent) {\n  const opts = event.detail\n  if (opts) {\n    navigateAppByName(opts)\n  }\n})\n")])])]),n("p",[t._v("剩下的诸如 Loading 动画也是类似的。")]),t._v(" "),n("h1",{attrs:{id:"大型-angular-应用微前端的四种拆分策略-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#大型-angular-应用微前端的四种拆分策略-2"}},[t._v("#")]),t._v(" 大型 Angular 应用微前端的四种拆分策略")]),t._v(" "),n("p",[t._v("上一个月，我们花了大量的时间不熂设计方案来拆分一个大型的 Angular 应用。从使用 Angular 的 Lazyload 到前端微服务化，进行了一系列的讨论。最后，我们终于有了结果，采用的是 Lazyload 变体："),n("strong",[t._v("构建时集成代码")]),t._v(" 的方式。")]),t._v(" "),n("p",[t._v("过去的几周里，作为一个 “专业” 的咨询师，一直忙于在为客户设计一个 Angular 拆分的服务化方案。主要是为了达成以下的设计目标：")]),t._v(" "),n("ul",[n("li",[t._v("构建插件化的 Web 开发平台，满足业务快速变化及分布式多团队并行开发的需求")]),t._v(" "),n("li",[t._v("构建服务化的中间件，搭建高可用及高复用的前端微服务平台")]),t._v(" "),n("li",[t._v("支持前端的独立交付及部署")])]),t._v(" "),n("p",[t._v("简单地来说，就是要支持"),n("strong",[t._v("应用插件化开发")]),t._v("，以及"),n("strong",[t._v("多团队并行开发")]),t._v("。")]),t._v(" "),n("p",[n("strong",[t._v("应用插件化开发")]),t._v("，其所要解决的主要问题是：臃肿的大型应用的拆分问题。大型前端应用，在开发的时候要面临大量的"),n("strong",[t._v("遗留代码")]),t._v("、不同业务的代码耦合在一起，在线上的时候还要面临加载速度慢，运行效率低的问题。")]),t._v(" "),n("p",[t._v("最后就落在了两个方案上：路由懒加载及其变体与前端微服务化")]),t._v(" "),n("h2",{attrs:{id:"前端微服务化-路由懒加载及其变体-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化-路由懒加载及其变体-2"}},[t._v("#")]),t._v(" 前端微服务化：路由懒加载及其变体")]),t._v(" "),n("p",[t._v("路由懒加载，即通过不同的路由来将应用切成不同的代码快，当路由被访问的时候，才加载对应组件。在诸如 Angular、Vue 框架里都可以通过路由 +  Webpack 打包的方式来实现。而，不可避免地就会需要一些问题：")]),t._v(" "),n("p",[n("strong",[t._v("难以多团队并行开发")]),t._v("，路由拆分就意味着我们仍然是在一个源码库里工作的。也可以尝试拆分成不同的项目，再编译到一起。")]),t._v(" "),n("p",[n("strong",[t._v("每次发布需要重新编译")]),t._v("，是的，当我们只是更新一个子模块的代码，我们要重新编译整个应用，再重新发布这个应用。而不能独立地去构建它，再发布它。")]),t._v(" "),n("p",[n("strong",[t._v("统一的 Vendor 版本")]),t._v("，统一第三方依赖是一件好事。可问题的关键在于：每当我们添加一个新的依赖，我们可能就需要开会讨论一下。")]),t._v(" "),n("p",[t._v("然而，标准 Route Lazyload 最大的问题就是"),n("strong",[t._v("难以多团队并行开发")]),t._v("，这里之所以说的是 “难以” 是因为，还是有办法解决这个问题。在日常的开发中，一个小的团队会一直在一个代码库里开发，而一个大的团队则应该是在不同的代码库里开发。")]),t._v(" "),n("p",[t._v("于是，我们在标准的路由懒加载之上做了一些尝试。")]),t._v(" "),n("p",[t._v("对于一个二三十人规模的团队来说，他们可能在业务上归属于不同的部门，技术上也有一些不一致的规范，如 4 个空格、2 个空格还是使用 Tab 的问题。特别是当它是不同的公司和团队时，他们可能要放弃测试、代码静态检测、代码风格统一等等的一系列问题。")]),t._v(" "),n("h2",{attrs:{id:"微服务化方案-子应用模式-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微服务化方案-子应用模式-2"}},[t._v("#")]),t._v(" 微服务化方案：子应用模式")]),t._v(" "),n("p",[t._v("除了路由懒加载，我们还可以采用子应用模式，即每个应用都是相互独立地。即我们有一个基座工程，当用户点击相应的路由时，我们去加载这个"),n("strong",[t._v("独立")]),t._v(" 的 Angular 应用；如果是同一个应用下的路由，就不需要重复加载了。而且，这些都可以依赖于浏览器缓存来做。")]),t._v(" "),n("p",[t._v("除了路由懒加载，还可以采用的是类似于 Mooa 的应用嵌入方案。如下是基于 Mooa 框架 + Angular 开发而生成的 HTML 示例：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<app-root _nghost-c0="" ng-version="4.2.0">\n  ...\n  <app-home _nghost-c2="">\n    <app-app1 _nghost-c0="" ng-version="5.2.8" style="display: none;"><nav _ngcontent-c0="" class="navbar"></app-app1>\n    <iframe frameborder="" width="100%" height="100%" src="http://localhost:4200/app/help/homeassets/iframe.html" id="help_206547"></iframe>\n  </app-home>\n</app-root>\n')])])]),n("p",[t._v("Mooa 提供了两种模式，一种是基于 Single-SPA 的实验做的，在同一页面加载、渲染两个 Angular 应用；一种是基于 iFrame 来提供独立的应用容器。")]),t._v(" "),n("p",[t._v("解决了以下的问题：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("首页加载速度更快")]),t._v("，因为只需要加载首页所需要的功能，而不是所有的依赖。")]),t._v(" "),n("li",[n("strong",[t._v("多个团队并行开发")]),t._v("，每个团队里可以独立地在自己的项目里开发。")]),t._v(" "),n("li",[n("strong",[t._v("独立地进行模块化更新")]),t._v("，现在我们只需要去单独更新我们的应用，而不需要更新整个完整的应用。")])]),t._v(" "),n("p",[t._v("但是，它仍然包含有以下的问题：")]),t._v(" "),n("ul",[n("li",[t._v("重复加载依赖项，即我们在 A 应用中使用到的模块，在 B 应用中也会重新使用到。有一部分可以通过浏览器的缓存来自动解决。")]),t._v(" "),n("li",[t._v("第一次打开对应的应用需要时间，当然"),n("strong",[t._v("预加载")]),t._v("可以解决一部分问题。")]),t._v(" "),n("li",[t._v("在非 iframe 模式下运行，会遇到难以预料的第三方依赖冲突。")])]),t._v(" "),n("p",[t._v("于是在总结了一系列的讨论之后，我们形成了一系列的对比方案：")]),t._v(" "),n("h2",{attrs:{id:"方案对比-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方案对比-2"}},[t._v("#")]),t._v(" 方案对比")]),t._v(" "),n("p",[t._v("在这个过程中，我们做了大量的方案设计与对比，便想写一篇文章对比一下之前的结果。先看一下图：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(306),alt:"Angular 代码拆分对比"}})]),t._v(" "),n("p",[t._v("表格对比：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("x")]),t._v(" "),n("th",[t._v("标准 Lazyload")]),t._v(" "),n("th",[t._v("构建时集成")]),t._v(" "),n("th",[t._v("构建后集成")]),t._v(" "),n("th",[t._v("应用独立")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("开发流程")]),t._v(" "),n("td",[t._v("多个团队在同一个代码库里开发")]),t._v(" "),n("td",[t._v("多个团队在不同的代码库里开发")]),t._v(" "),n("td",[t._v("多个团队在不同的代码库里开发")]),t._v(" "),n("td",[t._v("多个团队在不同的代码库里开发")])]),t._v(" "),n("tr",[n("td",[t._v("构建与发布")]),t._v(" "),n("td",[t._v("构建时只需要拿这一份代码去构建、部署")]),t._v(" "),n("td",[t._v("将不同代码库的代码整合到一起，再构建应用")]),t._v(" "),n("td",[t._v("将直接编译成各个项目模块，运行时通过懒加载合并")]),t._v(" "),n("td",[t._v("将直接编译成不同的几个应用，运行时通过主工程加载")])]),t._v(" "),n("tr",[n("td",[t._v("适用场景")]),t._v(" "),n("td",[t._v("单一团队，依赖库少、业务单一")]),t._v(" "),n("td",[t._v("多团队，依赖库少、业务单一")]),t._v(" "),n("td",[t._v("多团队，依赖库少、业务单一")]),t._v(" "),n("td",[t._v("多团队，依赖库多、业务复杂")])]),t._v(" "),n("tr",[n("td",[t._v("表现方式")]),t._v(" "),n("td",[t._v("开发、构建、运行一体")]),t._v(" "),n("td",[t._v("开发分离，构建时集成，运行一体")]),t._v(" "),n("td",[t._v("开发分离，构建分离，运行一体")]),t._v(" "),n("td",[t._v("开发、构建、运行分离")])])])]),t._v(" "),n("p",[t._v("详细的介绍如下：")]),t._v(" "),n("h3",{attrs:{id:"标准-lazyload-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#标准-lazyload-2"}},[t._v("#")]),t._v(" 标准 LazyLoad")]),t._v(" "),n("p",[t._v("开发流程：多个团队在同一个代码库里开发，构建时只需要拿这一份代码去部署。")]),t._v(" "),n("p",[t._v("行为：开发、构建、运行一体")]),t._v(" "),n("p",[t._v("适用场景：单一团队，依赖库少、业务单一")]),t._v(" "),n("h3",{attrs:{id:"lazyload-变体-1-构建时集成-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lazyload-变体-1-构建时集成-2"}},[t._v("#")]),t._v(" LazyLoad 变体 1：构建时集成")]),t._v(" "),n("p",[t._v("开发流程：多个团队在不同的代码库里开发，在构建时将不同代码库的代码整合到一起，再去构建这个应用。")]),t._v(" "),n("p",[t._v("适用场景：多团队，依赖库少、业务单一")]),t._v(" "),n("p",[t._v("变体-构建时集成：开发分离，构建时集成，运行一体")]),t._v(" "),n("h3",{attrs:{id:"lazyload-变体-2-构建后集成-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lazyload-变体-2-构建后集成-2"}},[t._v("#")]),t._v(" LazyLoad 变体 2：构建后集成")]),t._v(" "),n("p",[t._v("开发流程：多个团队在不同的代码库里开发，在构建时将编译成不同的几份代码，运行时会通过懒加载合并到一起。")]),t._v(" "),n("p",[t._v("适用场景：多团队，依赖库少、业务单一")]),t._v(" "),n("p",[t._v("变体-构建后集成：开发分离，构建分离，运行一体")]),t._v(" "),n("h3",{attrs:{id:"前端微服务化-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化-2"}},[t._v("#")]),t._v(" 前端微服务化")]),t._v(" "),n("p",[t._v("开发流程：多个团队在不同的代码库里开发，在构建时将编译成不同的几个应用，运行时通过主工程加载。")]),t._v(" "),n("p",[t._v("适用场景：多团队，依赖库多、业务复杂")]),t._v(" "),n("p",[t._v("前端微服务化：开发、构建、运行分离")]),t._v(" "),n("h2",{attrs:{id:"总对比-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总对比-2"}},[t._v("#")]),t._v(" 总对比")]),t._v(" "),n("p",[t._v("总体的对比如下表所示：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("x")]),t._v(" "),n("th",[t._v("标准 Lazyload")]),t._v(" "),n("th",[t._v("构建时集成")]),t._v(" "),n("th",[t._v("构建后集成")]),t._v(" "),n("th",[t._v("应用独立")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("依赖管理")]),t._v(" "),n("td",[t._v("统一管理")]),t._v(" "),n("td",[t._v("统一管理")]),t._v(" "),n("td",[t._v("统一管理")]),t._v(" "),n("td",[t._v("各应用独立管理")])]),t._v(" "),n("tr",[n("td",[t._v("部署方式")]),t._v(" "),n("td",[t._v("统一部署")]),t._v(" "),n("td",[t._v("统一部署")]),t._v(" "),n("td",[t._v("可单独部署。更新依赖时，需要全量部署")]),t._v(" "),n("td",[t._v("可完全独立部署")])]),t._v(" "),n("tr",[n("td",[t._v("首屏加载")]),t._v(" "),n("td",[t._v("依赖在同一个文件，加载速度慢")]),t._v(" "),n("td",[t._v("依赖在同一个文件，加载速度慢")]),t._v(" "),n("td",[t._v("依赖在同一个文件，加载速度慢")]),t._v(" "),n("td",[t._v("依赖各自管理，首页加载快")])]),t._v(" "),n("tr",[n("td",[t._v("首次加载应用、模块")]),t._v(" "),n("td",[t._v("只加载模块，速度快")]),t._v(" "),n("td",[t._v("只加载模块，速度快")]),t._v(" "),n("td",[t._v("只加载模块，速度快")]),t._v(" "),n("td",[t._v("单独加载，加载略慢")])]),t._v(" "),n("tr",[n("td",[t._v("前期构建成本")]),t._v(" "),n("td",[t._v("低")]),t._v(" "),n("td",[t._v("设计构建流程")]),t._v(" "),n("td",[t._v("设计构建流程")]),t._v(" "),n("td",[t._v("设计通讯机制与加载方式")])]),t._v(" "),n("tr",[n("td",[t._v("维护成本")]),t._v(" "),n("td",[t._v("一个代码库不好管理")]),t._v(" "),n("td",[t._v("多个代码库不好统一")]),t._v(" "),n("td",[t._v("后期需要维护组件依赖")]),t._v(" "),n("td",[t._v("后期维护成本低")])]),t._v(" "),n("tr",[n("td",[t._v("打包优化")]),t._v(" "),n("td",[t._v("可进行摇树优化、AoT 编译、删除无用代码")]),t._v(" "),n("td",[t._v("可进行摇树优化、AoT 编译、删除无用代码")]),t._v(" "),n("td",[t._v("应用依赖的组件无法确定，不能删除无用代码")]),t._v(" "),n("td",[t._v("可进行摇树优化、AoT 编译、删除无用代码")])])])]),t._v(" "),n("h1",{attrs:{id:"前端微服务化-使用微前端框架-mooa-开发微前端应用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化-使用微前端框架-mooa-开发微前端应用-2"}},[t._v("#")]),t._v(" 前端微服务化：使用微前端框架 Mooa 开发微前端应用")]),t._v(" "),n("p",[t._v("Mooa 是一个为 Angular 服务的微前端框架，它是一个基于 "),n("a",{attrs:{href:"https://github.com/CanopyTax/single-spa",target:"_blank",rel:"noopener noreferrer"}},[t._v("single-spa"),n("OutboundLink")],1),t._v("，针对 IE 10 及 IFRAME 优化的微前端解决方案。")]),t._v(" "),n("h2",{attrs:{id:"mooa-概念-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mooa-概念-2"}},[t._v("#")]),t._v(" Mooa 概念")]),t._v(" "),n("p",[t._v("Mooa 框架与 Single-SPA 不一样的是，Mooa 采用的是 Master-Slave 架构，即主-从式设计。")]),t._v(" "),n("p",[t._v("对于 Web 页面来说，它可以同时存在两个到多个的 Angular 应用：其中的一个 Angular 应用作为主工程存在，剩下的则是子应用模块。")]),t._v(" "),n("ul",[n("li",[t._v("主工程，负责加载其它应用，及用户权限管理等核心控制功能。")]),t._v(" "),n("li",[t._v("子应用，负责不同模块的具体业务代码。")])]),t._v(" "),n("p",[t._v("在这种模式下，则由主工程来控制整个系统的行为，子应用则做出一些对应的响应。")]),t._v(" "),n("h2",{attrs:{id:"微前端主工程创建-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端主工程创建-2"}},[t._v("#")]),t._v(" 微前端主工程创建")]),t._v(" "),n("p",[t._v("要创建微前端框架 Mooa 的主工程，并不需要多少修改，只需要使用 "),n("code",[t._v("angular-cli")]),t._v(" 来生成相应的应用：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("ng new hello-world\n")])])]),n("p",[t._v("然后添加 "),n("code",[t._v("mooa")]),t._v(" 依赖")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("yarn add mooa\n")])])]),n("p",[t._v("接着创建一个简单的配置文件 "),n("code",[t._v("apps.json")]),t._v("，放在 "),n("code",[t._v("assets")]),t._v(" 目录下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('[{\n    "name": "help",\n    "selector": "app-help",\n    "baseScriptUrl": "/assets/help",\n    "styles": [\n      "styles.bundle.css"\n    ],\n    "prefix": "help",\n    "scripts": [\n      "inline.bundle.js",\n      "polyfills.bundle.js",\n      "main.bundle.js"\n    ]\n  }\n]]\n')])])]),n("p",[t._v("接着，在我们的 "),n("code",[t._v("app.component.ts")]),t._v(" 中编写相应的创建应用逻辑：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("mooa = new Mooa({\n  mode: 'iframe',\n  debug: false,\n  parentElement: 'app-home',\n  urlPrefix: 'app',\n  switchMode: 'coexist',\n  preload: true,\n  includeZone: true\n});\n\nconstructor(private renderer: Renderer2, http: HttpClient, private router: Router) {\n  http.get<IAppOption[]>('/assets/apps.json')\n    .subscribe(\n      data => {\n        this.createApps(data);\n      },\n      err => console.log(err)\n    );\n}\n\nprivate createApps(data: IAppOption[]) {\n  data.map((config) => {\n    this.mooa.registerApplication(config.name, config, mooaRouter.hashPrefix(config.prefix));\n  });\n\n  const that = this;\n  this.router.events.subscribe((event) => {\n    if (event instanceof NavigationEnd) {\n      that.mooa.reRouter(event);\n    }\n  });\n\n  return mooa.start();\n}\n")])])]),n("p",[t._v("再为应用创建一个对应的路由即可：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("{\n  path: 'app/:appName/:route',\n  component: HomeComponent\n}\n")])])]),n("p",[t._v("接着，我们就可以创建 Mooa 子应用。")]),t._v(" "),n("h2",{attrs:{id:"mooa-子应用创建-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mooa-子应用创建-2"}},[t._v("#")]),t._v(" Mooa 子应用创建")]),t._v(" "),n("p",[t._v("Mooa 官方提供了一个子应用的模块，直接使用该模块即可：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("git clone https://github.com/phodal/mooa-boilerplate\n")])])]),n("p",[t._v("然后执行：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("npm install\n")])])]),n("p",[t._v("在安装完依赖后，会进行项目的初始化设置，如更改包名等操作。在这里，将我们的应用取名为 help。")]),t._v(" "),n("p",[t._v("然后，我们就可以完成子应用的构建。")]),t._v(" "),n("p",[t._v("接着，执行："),n("code",[t._v("yarn build")]),t._v(" 就可以构建出我们的应用。")]),t._v(" "),n("p",[t._v("将 "),n("code",[t._v("dist")]),t._v(" 目录一下的文件拷贝到主工程的 src/assets/help 目录下，再启动主工程即可。")]),t._v(" "),n("h2",{attrs:{id:"导航到特定的子应用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#导航到特定的子应用-2"}},[t._v("#")]),t._v(" 导航到特定的子应用")]),t._v(" "),n("p",[t._v("在 Mooa 中，有一个路由接口 "),n("code",[t._v("mooaPlatform.navigateTo")]),t._v("，具体使用情况如下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("mooaPlatform.navigateTo({\n  appName: 'help',\n  router: 'home'\n});\n")])])]),n("p",[t._v("它将触发一个 "),n("code",[t._v("MOOA_EVENT.ROUTING_NAVIGATE")]),t._v(" 事件。而在我们调用 "),n("code",[t._v("mooa.start()")]),t._v(" 方法时，则会开发监听对应的事件：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("window.addEventListener(MOOA_EVENT.ROUTING_NAVIGATE, function(event: CustomEvent) {\n  if (event.detail) {\n    navigateAppByName(event.detail)\n  }\n})\n")])])]),n("p",[t._v("它将负责将应用导向新的应用。")]),t._v(" "),n("p",[t._v("嗯，就是这么简单。DEMO 视频如下：")]),t._v(" "),n("p",[t._v("Demo 地址见："),n("a",{attrs:{href:"http://mooa.phodal.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://mooa.phodal.com/"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("GitHub 示例："),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/phodal/mooa"),n("OutboundLink")],1)]),t._v(" "),n("h1",{attrs:{id:"前端微服务化-使用特制的-iframe-微服务化-angular-应用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端微服务化-使用特制的-iframe-微服务化-angular-应用-2"}},[t._v("#")]),t._v(" 前端微服务化：使用特制的 iframe 微服务化 Angular 应用")]),t._v(" "),n("p",[t._v("Angular 基于 Component 的思想，可以让其在一个页面上同时运行多个 Angular 应用；可以在一个 DOM 节点下，存在多个 Angular 应用，即类似于下面的形式：")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-home")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c3")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-help")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_ngcontent-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-help")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-app1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("nav")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_ngcontent-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("navbar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-app1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-app2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("nav")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_ngcontent-c0")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("navbar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-app2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-home")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("可这一样一来，难免需要做以下的一些额外的工作：")]),t._v(" "),n("ul",[n("li",[t._v("创建子应用项目模板，以统一 Angular 版本")]),t._v(" "),n("li",[t._v("构建时，删除子应用的依赖")]),t._v(" "),n("li",[t._v("修改第三方模块")])]),t._v(" "),n("p",[t._v("而在这其中最麻烦的就是"),n("strong",[t._v("第三方模块")]),t._v("冲突问题。思来想去，在三月中旬，我在 Mooa 中添加了一个 iframe 模式。")]),t._v(" "),n("h2",{attrs:{id:"iframe-微服务架构设计-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#iframe-微服务架构设计-2"}},[t._v("#")]),t._v(" iframe 微服务架构设计")]),t._v(" "),n("p",[t._v("在这里，总的设计思想和之前的《"),n("a",{attrs:{href:"https://www.phodal.com/blog/how-to-build-a-microfrontend-framework-mooa/",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何解构单体前端应用——前端应用的微服务式拆分"),n("OutboundLink")],1),t._v("》中介绍是一致的：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(308),alt:"Mooa 架构"}})]),t._v(" "),n("p",[t._v("主要过程如下：")]),t._v(" "),n("ul",[n("li",[t._v("主工程在运行的时候，会去服务器获取最新的应用配置。")]),t._v(" "),n("li",[t._v("主工程在获取到配置后，将一一创建应用，并为应用绑定生命周期。")]),t._v(" "),n("li",[t._v("当主工程监测到路由变化的时候，将寻找是否有对应的路由匹配到应用。")]),t._v(" "),n("li",[t._v("当匹配对对应应用时，则"),n("strong",[t._v("创建或显示相应应用的 iframe")]),t._v("，并隐藏其它子应用的 iframe。")])]),t._v(" "),n("p",[t._v("其加载形式与之前的 Component 模式并没有太大的区别：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(309),alt:"Mooa Component 加载"}})]),t._v(" "),n("p",[t._v("而为了控制不同的 iframe 需要做到这么几件事：")]),t._v(" "),n("ol",[n("li",[t._v("为不同的子应用分配 ID")]),t._v(" "),n("li",[t._v("在子应用中进行 hook，以通知主应用：子应用已加载")]),t._v(" "),n("li",[t._v("在子应用中创建对应的事件监听，来响应主应用的 URL 变化事件")]),t._v(" "),n("li",[t._v("在主应用中监听子程序的路由跳转等需求")])]),t._v(" "),n("p",[t._v("因为大部分的代码可以与之前的 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mooa"),n("OutboundLink")],1),t._v(" 复用，于是我便在 Mooa 中实现了相应的功能。")]),t._v(" "),n("h2",{attrs:{id:"微前端框架-mooa-的特制-iframe-模式-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端框架-mooa-的特制-iframe-模式-2"}},[t._v("#")]),t._v(" 微前端框架 Mooa 的特制 iframe 模式")]),t._v(" "),n("p",[t._v("iframe 可以创建一个"),n("strong",[t._v("全新的独立的宿主环境")]),t._v("，这意味着我们的 Angular 应用之间可以相互独立运行，我们唯一要做的是："),n("strong",[t._v("建立一个通讯机制")]),t._v("。")]),t._v(" "),n("p",[t._v("它可以不修改子应用代码的情况下，可以直接使用。与此同时，它在一般的 iframe 模式进行了优化。使用普通的 iframe 模式，意味着："),n("strong",[t._v("我们需要加载大量的重复组件")]),t._v("，即使经过 Tree-Shaking 优化，它也将带来大量的重复内容。如果子应用过多，那么它在初始化应用的时候，体验可能就没有那么友好。但是与此相比，在初始化应用的时候，加载所有的依赖在主程序上，也不是一种很友好的体验。")]),t._v(" "),n("p",[t._v("于是，我就在想能不能创建一个更友好地 IFrame 模式，在里面对应用及依赖进行处理。如下，就是最后生成的页面的 iframe 代码：")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("app-home")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("_nghost-c2")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ng-version")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("5.2.8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("frameborder")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("height")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://localhost:4200/assets/iframe.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("help_206547"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("frameborder")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("height")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://localhost:4200/assets/iframe.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('id="app_235458')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token style-attr"}},[n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),n("span",{pre:!0,attrs:{class:"token style language-css"}},[n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("app-home")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("对，两个 iframe 的 src 是一样的，但是它表现出来的确实是两个不同的 iframe 应用。那个 iframe.html 里面其实是没有内容的：")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("doctype")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("utf-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("App1"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("base")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width,initial-scale=1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("icon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("image/x-icon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("favicon.ico"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("（PS：详细的代码可以见 "),n("a",{attrs:{href:"https://github.com/phodal/mooa",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/phodal/mooa"),n("OutboundLink")],1),t._v("）")]),t._v(" "),n("p",[t._v("只是为了创建 iframe 的需要而存在的，对于一个 Angular 应用来说，是不是一个 iframe 的区别并不大。但是，对于我们而言，区别就大了。我们可以使用自己的方式来控制这个 IFrame，以及我们所要加载的内容。如：")]),t._v(" "),n("ul",[n("li",[t._v("共同 Style Guide 中的 CSS 样式。如，在使用 iframe 集成时，移除不需要的 "),n("link")]),t._v(" "),n("li",[t._v("去除不需要重复加载的 JavaScript。如，打包时不需要的 zone.min.js、polyfill.js 等等")])]),t._v(" "),n("p",[n("code",[t._v("注意")]),t._v("：对于一些共用 UI 组件而言，仍然需要重复加载。这也就是 iframe 模式下的问题。")]),t._v(" "),n("h2",{attrs:{id:"微前端框架-mooa-iframe-通讯机制-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微前端框架-mooa-iframe-通讯机制-2"}},[t._v("#")]),t._v(" 微前端框架 Mooa iframe 通讯机制")]),t._v(" "),n("p",[t._v("为了在主工程与子工程通讯，我们需要做到这么一些事件策略：")]),t._v(" "),n("h3",{attrs:{id:"发布主应用事件-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布主应用事件-2"}},[t._v("#")]),t._v(" 发布主应用事件")]),t._v(" "),n("p",[t._v("由于，我们使用 Mooa 来控制 iframe 加载。这就意味着我们可以通过 "),n("code",[t._v("document.getElementById")]),t._v(" 来获取到 iframe，随后通过 "),n("code",[t._v("iframeEl.contentWindow")]),t._v(" 来发布事件，如下：")]),t._v(" "),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" iframeEl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframeId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframeEl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" iframeEl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  iframeEl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("option "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("option\n  iframeEl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatchEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MOOA_EVENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ROUTING_CHANGE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" detail"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" eventArgs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这样，子应用就不需要修改代码，就可以直接接收对应的事件响应。")]),t._v(" "),n("h3",{attrs:{id:"监听子应用事件-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#监听子应用事件-2"}},[t._v("#")]),t._v(" 监听子应用事件")]),t._v(" "),n("p",[t._v("由于，我们也希望能直接在主工程中处理子程序的事件，并且不修改原有的代码。因此，我们也使用同样的方式来在子应用中监听主应用的事件：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("iframeEl.contentWindow.addEventListener(MOOA_EVENT.ROUTING_NAVIGATE, function(event: CustomEvent) {\n  if (event.detail) {\n    navigateAppByName(event.detail)\n  }\n})\n")])])]),n("h2",{attrs:{id:"示例-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例-2"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),n("p",[t._v("同样的我们仍以 Mooa 框架作为示例，我们只需要在创建 mooa 实例时，配置使用 iframe 模式即可：")]),t._v(" "),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mooa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  mode"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  debug"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  parentElement"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app-home'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  urlPrefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  switchMode"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'coexist'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  preload"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  includeZone"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\nthat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerApplicationByLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'help'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/assets/help'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mooaRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchRoute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'help'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nthat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerApplicationByLink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/assets/app1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mooaRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchRoute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NavigationEnd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    that"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mooa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reRouter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("子程序则直接使用："),n("a",{attrs:{href:"https://github.com/phodal/mooa-boilerplate",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/phodal/mooa-boilerplate"),n("OutboundLink")],1),t._v(" 就可以了。")]),t._v(" "),n("h1",{attrs:{id:"资源-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源-2"}},[t._v("#")]),t._v(" 资源")]),t._v(" "),n("p",[t._v("相关资料：")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/%E5%BD%B1%E5%AD%90_DOM",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN 影子DOM（Shadow DOM）"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Components"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://developers.google.com/web/fundamentals/web-components/shadowdom?hl=zh-cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shadow DOM v1：独立的网络组件"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/phodal/microfrontends",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/umijs/qiankun",target:"_blank",rel:"noopener noreferrer"}},[t._v("qiankun"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/aliyun/alibabacloud-alfa",target:"_blank",rel:"noopener noreferrer"}},[t._v("alibabacloud-alfa"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.cn/post/6948752328715403300",target:"_blank",rel:"noopener noreferrer"}},[t._v("worker 沙箱猜想"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/ampproject/worker-dom",target:"_blank",rel:"noopener noreferrer"}},[t._v("worker DOM"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.cn/post/6862661545592111111",target:"_blank",rel:"noopener noreferrer"}},[t._v("qiankun1"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.cn/post/6885211340999229454",target:"_blank",rel:"noopener noreferrer"}},[t._v("qiankun2"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.cn/post/6885214342552223757",target:"_blank",rel:"noopener noreferrer"}},[t._v("qiankun3"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.cn/post/6885212507837825038",target:"_blank",rel:"noopener noreferrer"}},[t._v("qiankun4"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);